{"version":3,"file":"AIChatCard-CNXREBUy.js","sources":["../../src/lib/gemini.ts","../../src/components/ai/ChatInput.tsx","../../src/components/ai/ChatMessageBubble.tsx","../../src/components/chat/useChatSession.ts","../../src/components/chat/useChatMemory.ts","../../src/components/chat/formatResponse.ts","../../src/components/ai/message-loading.tsx","../../src/components/ai/TypingIndicator.tsx","../../src/components/ai/AIChatCard.tsx"],"sourcesContent":["// // src/lib/gemini.ts\r\n// export type ChatMessage = {\r\n//   sender: 'user' | 'ai';\r\n//   text: string;\r\n// };\r\n\r\n// // ‚úÖ Gemini 2.0 Flash endpoint (v1beta) + CORS proxy\r\n// const MODEL_ID = 'gemini-2.0-flash';\r\n// const API_URL = `https://cors-anywhere.herokuapp.com/https://generativelanguage.googleapis.com/v1beta/models/${MODEL_ID}:generateContent`;\r\n\r\n// const apiKey = import.meta.env.VITE_GOOGLE_API_KEY;\r\n\r\n// if (!apiKey) {\r\n//   throw new Error('‚ùå Missing environment variable: VITE_GOOGLE_API_KEY');\r\n// }\r\n\r\n// // ‚úÖ Main chat function\r\n// export async function runChat(history: ChatMessage[]): Promise<string> {\r\n//   const prompt = history\r\n//     .map((msg) => `${msg.sender === 'user' ? 'User' : 'AI'}: ${msg.text}`)\r\n//     .join('\\n');\r\n\r\n//   try {\r\n//     const response = await fetch(`${API_URL}?key=${apiKey}`, {\r\n//       method: 'POST',\r\n//       headers: {\r\n//         'Content-Type': 'application/json',\r\n//         // Required by cors-anywhere proxy\r\n//         'x-requested-with': 'XMLHttpRequest',\r\n//       },\r\n//       body: JSON.stringify({\r\n//         contents: [\r\n//           {\r\n//             parts: [{ text: prompt }],\r\n//           },\r\n//         ],\r\n//       }),\r\n//     });\r\n\r\n//     if (!response.ok) {\r\n//       const err = await response.text();\r\n//       console.error('‚ùå Gemini API Error:', err);\r\n//       throw new Error(`Gemini request failed (${response.status})`);\r\n//     }\r\n\r\n//     const data = await response.json();\r\n//     const output =\r\n//       data?.candidates?.[0]?.content?.parts?.[0]?.text ||\r\n//       '‚ö†Ô∏è Gemini returned no response.';\r\n//     return output.trim();\r\n//   } catch (error) {\r\n//     console.error('‚ùå Gemini Chat Error:', error);\r\n//     return '‚ö†Ô∏è Something went wrong while fetching from Gemini.';\r\n//   }\r\n// }\r\n\r\n// src/lib/gemini.ts\r\nexport type ChatMessage = {\r\n  sender: 'ai' | 'user';\r\n  text: string;\r\n};\r\n\r\nconst API_URL =\r\n  import.meta.env.VITE_API_URL ||\r\n  'https://ai-assistant-server-colf.onrender.com/api/gemini';\r\n\r\nfunction delay(ms: number) {\r\n  return new Promise((resolve) => setTimeout(resolve, ms));\r\n}\r\n\r\ntype GeminiResponse = {\r\n  candidates?: {\r\n    content?: { parts?: { text: string }[] };\r\n  }[];\r\n};\r\n\r\ntype ServerResponse = {\r\n  data?: GeminiResponse;\r\n};\r\n\r\nexport async function runChat(chatHistory: ChatMessage[]): Promise<string> {\r\n  const messages = chatHistory.map((msg) => ({\r\n    role: msg.sender === 'ai' ? 'model' : 'user',\r\n    content: msg.text,\r\n  }));\r\n\r\n  let attempts = 0;\r\n  const maxRetries = 3;\r\n\r\n  while (attempts < maxRetries) {\r\n    try {\r\n      const controller = new AbortController();\r\n      const timeout = setTimeout(() => controller.abort(), 15000);\r\n\r\n      const response = await fetch(API_URL, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ messages }),\r\n        signal: controller.signal,\r\n      });\r\n\r\n      clearTimeout(timeout);\r\n\r\n      if (!response.ok) {\r\n        if (response.status === 429) {\r\n          attempts++;\r\n          console.warn(\r\n            `‚ö†Ô∏è Rate limit hit. Retrying... (${attempts}/${maxRetries})`\r\n          );\r\n          await delay(1500 * attempts);\r\n          continue;\r\n        }\r\n        throw new Error(`Gemini request failed (${response.status})`);\r\n      }\r\n\r\n      const serverData: ServerResponse = await response.json();\r\n      return (\r\n        serverData.data?.candidates?.[0]?.content?.parts?.[0]?.text ||\r\n        '‚ö†Ô∏è No response from Gemini.'\r\n      );\r\n    } catch (err) {\r\n      if (attempts >= maxRetries - 1) {\r\n        console.error('‚ùå Gemini Chat Error:', err);\r\n        return '‚ö†Ô∏è Gemini is currently unavailable. Please try again later.';\r\n      }\r\n      attempts++;\r\n      await delay(1500 * attempts);\r\n    }\r\n  }\r\n\r\n  return '‚ùå Gemini API limit reached. Please try again later.';\r\n}\r\n","import { Send } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\n\r\nexport default function ChatInput({\r\n  value,\r\n  onChange,\r\n  onSend,\r\n  disabled,\r\n}: {\r\n  value: string;\r\n  onChange: (val: string) => void;\r\n  onSend: () => void;\r\n  disabled: boolean;\r\n}) {\r\n  return (\r\n    <div className=\"flex items-center gap-2 p-3 border-t border-white/10 relative z-10\">\r\n      <input\r\n        className=\"flex-1 px-3 py-2 text-sm bg-black/50 rounded-lg border border-white/10 text-white focus:outline-none focus:ring-1 focus:ring-white/50\"\r\n        placeholder=\"Type a message...\"\r\n        value={value}\r\n        onChange={(e) => onChange(e.target.value)}\r\n        onKeyDown={(e) => e.key === 'Enter' && onSend()}\r\n      />\r\n      <button\r\n        onClick={onSend}\r\n        disabled={disabled}\r\n        className={cn(\r\n          'p-2 rounded-lg transition-colors',\r\n          disabled\r\n            ? 'bg-black/10 cursor-not-allowed'\r\n            : 'bg-white/10 hover:bg-white/20'\r\n        )}\r\n      >\r\n        <Send className=\"w-4 h-4 text-white\" />\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n","'use client';\r\n\r\nimport { useState, memo } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport ReactMarkdown from 'react-markdown';\r\nimport rehypeRaw from 'rehype-raw';\r\nimport remarkGfm from 'remark-gfm';\r\nimport { Prism as SyntaxHighlighter } from 'react-syntax-highlighter';\r\nimport { vscDarkPlus } from 'react-syntax-highlighter/dist/esm/styles/prism';\r\nimport {\r\n  Copy,\r\n  ThumbsUp,\r\n  Check,\r\n  ThumbsDown,\r\n  Volume2,\r\n  RefreshCw,\r\n  X,\r\n} from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport type { ChatMessage } from '../chat/chatTypes';\r\n\r\n// Memoized CodeBlock component for performance and clean code\r\nconst CodeBlock = memo(({ inline, className, children }) => {\r\n  const [copied, setCopied] = useState(false);\r\n  const match = /language-(\\w+)/.exec(className || '');\r\n  const codeString = String(children).replace(/\\n$/, '');\r\n\r\n  const handleCopyCode = () => {\r\n    navigator.clipboard.writeText(codeString);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 2000);\r\n  };\r\n\r\n  return !inline && match ? (\r\n    <div className=\"relative my-2\">\r\n      <button\r\n        onClick={handleCopyCode}\r\n        className=\"absolute top-2 right-2 p-1.5 rounded-md bg-black/30 text-white/70 hover:bg-black/50 hover:text-white transition-all\"\r\n        title=\"Copy code\"\r\n      >\r\n        {copied ? (\r\n          <Check className=\"w-4 h-4 text-green-400\" />\r\n        ) : (\r\n          <Copy className=\"w-4 h-4\" />\r\n        )}\r\n      </button>\r\n      <SyntaxHighlighter\r\n        language={match[1]}\r\n        PreTag=\"div\"\r\n        showLineNumbers={false}\r\n        wrapLongLines\r\n        style={vscDarkPlus}\r\n        customStyle={{\r\n          borderRadius: '0.5rem',\r\n          padding: '1rem',\r\n          fontSize: '0.875rem',\r\n        }}\r\n      >\r\n        {codeString}\r\n      </SyntaxHighlighter>\r\n    </div>\r\n  ) : (\r\n    <code className=\"px-1.5 py-1 rounded bg-white/20 text-[0.9em]\">\r\n      {children}\r\n    </code>\r\n  );\r\n});\r\n\r\nexport default function ChatMessageBubble({\r\n  msg,\r\n  onRegenerate,\r\n  allMessages,\r\n}: {\r\n  msg: ChatMessage;\r\n  onRegenerate?: () => void;\r\n  allMessages?: ChatMessage[];\r\n}) {\r\n  const isAI = msg.sender === 'ai';\r\n  const [liked, setLiked] = useState(false);\r\n  const [disliked, setDisliked] = useState(false);\r\n  const [copied, setCopied] = useState(false);\r\n  const [isSpeaking, setIsSpeaking] = useState(false);\r\n\r\n  // Copy single message\r\n  const handleCopy = () => {\r\n    navigator.clipboard.writeText(msg.text);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 1500);\r\n  };\r\n\r\n  // Copy all messages\r\n  const handleCopyAll = () => {\r\n    if (!allMessages || !allMessages.length) return;\r\n    const text = allMessages\r\n      .map((m) => `${m.sender === 'ai' ? 'AI' : 'User'}: ${m.text}`)\r\n      .join('\\n\\n');\r\n    navigator.clipboard.writeText(text);\r\n    setCopied(true);\r\n    setTimeout(() => setCopied(false), 1500);\r\n  };\r\n\r\n  // Speak / Stop Speaking\r\n  const handleSpeak = () => {\r\n    if (isSpeaking) {\r\n      speechSynthesis.cancel();\r\n      setIsSpeaking(false);\r\n      return;\r\n    }\r\n    if (!msg.text) return;\r\n    const utter = new SpeechSynthesisUtterance(msg.text);\r\n\r\n    // --- Voice Tone Enhancement ---\r\n    // Find a high-quality voice if available\r\n    const voices = speechSynthesis.getVoices();\r\n    const preferredVoice =\r\n      voices.find(\r\n        (voice) =>\r\n          /en-US/i.test(voice.lang) && /google|microsoft/i.test(voice.name)\r\n      ) || voices.find((voice) => /en-US/i.test(voice.lang));\r\n\r\n    if (preferredVoice) {\r\n      utter.voice = preferredVoice;\r\n    }\r\n    utter.pitch = 1; // Range from 0 to 2, 1 is default\r\n    utter.rate = 1.1; // Range from 0.1 to 10, 1 is default\r\n    // --- End Enhancement ---\r\n\r\n    utter.onstart = () => setIsSpeaking(true);\r\n    utter.onend = () => setIsSpeaking(false);\r\n    utter.onerror = () => setIsSpeaking(false);\r\n    speechSynthesis.speak(utter);\r\n  };\r\n\r\n  return (\r\n    <motion.div\r\n      initial={{ opacity: 0, y: 8 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      transition={{ duration: 0.25, ease: 'easeOut' }}\r\n      className={cn(\r\n        'group max-w-[80%] px-4 py-3 rounded-xl shadow-md backdrop-blur-md break-words whitespace-pre-wrap relative mb-4',\r\n        isAI // AI messages: light gray on dark background\r\n          ? 'bg-white/10 text-white self-start' // User messages: vibrant blue\r\n          : 'bg-white/85 text-black font-semibold self-end'\r\n      )}\r\n    >\r\n      {/* Markdown Content */}\r\n      <ReactMarkdown\r\n        rehypePlugins={[rehypeRaw]}\r\n        remarkPlugins={[remarkGfm]}\r\n        className={cn(\r\n          'prose prose-sm max-w-none prose-p:text-inherit prose-headings:text-inherit prose-strong:text-inherit',\r\n          isAI ? 'prose-invert' : ''\r\n        )}\r\n        components={{\r\n          code: CodeBlock,\r\n        }}\r\n      >\r\n        {msg.text}\r\n      </ReactMarkdown>\r\n\r\n      {/* Action Buttons - Appear on Hover */}\r\n      <div className=\"absolute -bottom-4 right-0 flex items-center gap-1 p-1 rounded-full bg-black/20 border border-white/10 opacity-0 group-hover:opacity-100 group-hover:-bottom-5 transition-all duration-300\">\r\n        {isAI && (\r\n          <>\r\n            <button\r\n              onClick={() => {\r\n                setLiked(!liked);\r\n                setDisliked(false);\r\n              }}\r\n              title=\"Like\"\r\n              className={cn('icon-action-btn', liked && 'text-green-400')}\r\n            >\r\n              <ThumbsUp className=\"w-4 h-4\" />\r\n            </button>\r\n            <button\r\n              onClick={() => {\r\n                setDisliked(!disliked);\r\n                setLiked(false);\r\n              }}\r\n              title=\"Dislike\"\r\n              className={cn('icon-action-btn', disliked && 'text-red-400')}\r\n            >\r\n              <ThumbsDown className=\"w-4 h-4\" />\r\n            </button>\r\n          </>\r\n        )}\r\n\r\n        {allMessages && allMessages.length > 1 && (\r\n          <button\r\n            onClick={handleCopyAll}\r\n            title=\"Copy All Messages\"\r\n            className=\"icon-action-btn\"\r\n          >\r\n            <Copy className=\"w-4 h-4 rotate-45\" />\r\n          </button>\r\n        )}\r\n        <button\r\n          onClick={handleCopy}\r\n          title={copied ? 'Copied!' : 'Copy Message'}\r\n          className={cn('icon-action-btn', copied && 'text-green-400')}\r\n        >\r\n          {copied ? (\r\n            <Check className=\"w-4 h-4\" />\r\n          ) : (\r\n            <Copy className=\"w-4 h-4\" />\r\n          )}\r\n        </button>\r\n\r\n        {isAI && onRegenerate && !isSpeaking && (\r\n          <button\r\n            onClick={onRegenerate}\r\n            title=\"Regenerate\"\r\n            className=\"icon-action-btn\"\r\n          >\r\n            <RefreshCw className=\"w-4 h-4\" />\r\n          </button>\r\n        )}\r\n\r\n        <button\r\n          onClick={handleSpeak}\r\n          title={isSpeaking ? 'Stop' : 'Speak'}\r\n          className={cn('icon-action-btn', isSpeaking && 'text-blue-400')}\r\n        >\r\n          {isSpeaking ? (\r\n            <X className=\"w-4 h-4 animate-pulse\" />\r\n          ) : (\r\n            <Volume2 className=\"w-4 h-4\" />\r\n          )}\r\n        </button>\r\n      </div>\r\n    </motion.div>\r\n  );\r\n}\r\n","import React, { useEffect, useState, useCallback } from 'react';\r\nimport type { ChatMessage } from './chatTypes';\r\n\r\nconst STORAGE_KEY = 'aiChatHistory';\r\n\r\n/**\r\n * A custom hook to manage and persist a chat session's messages.\r\n * It automatically saves messages to `sessionStorage` and restores them on page load.\r\n *\r\n * @param initialMessages The initial array of messages to use if no session is found in storage.\r\n * @returns An object containing the current messages, a setter function, and a function to clear the session.\r\n */\r\nexport function useChatSession(initialMessages: readonly ChatMessage[]) {\r\n  const [messages, setMessages] = useState<ChatMessage[]>(() => {\r\n    // This function now runs only once on component mount for initialization.\r\n    if (typeof window !== 'undefined') {\r\n      try {\r\n        const saved = sessionStorage.getItem(STORAGE_KEY);\r\n        if (saved) {\r\n          const parsed = JSON.parse(saved);\r\n          // Basic validation to ensure we're loading an array.\r\n          if (Array.isArray(parsed)) {\r\n            return parsed;\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error(\r\n          'Failed to parse chat history from sessionStorage:',\r\n          error\r\n        );\r\n        // If parsing fails, clear the corrupted storage.\r\n        sessionStorage.removeItem(STORAGE_KEY);\r\n      }\r\n    }\r\n    // Fallback to initial messages if nothing is in storage or if in SSR.\r\n    return [...initialMessages];\r\n  });\r\n\r\n  // Effect to persist messages to sessionStorage whenever they change.\r\n  useEffect(() => {\r\n    try {\r\n      sessionStorage.setItem(STORAGE_KEY, JSON.stringify(messages));\r\n    } catch (error) {\r\n      console.error('Failed to save chat history to sessionStorage:', error);\r\n    }\r\n  }, [messages]);\r\n\r\n  /**\r\n   * Clears the current chat session from storage and resets the messages\r\n   * to the initial state provided to the hook.\r\n   */\r\n  const clearSession = useCallback(() => {\r\n    try {\r\n      sessionStorage.removeItem(STORAGE_KEY);\r\n      setMessages([...initialMessages]);\r\n    } catch (error) {\r\n      console.error('Failed to clear chat session from sessionStorage:', error);\r\n    }\r\n  }, [initialMessages]);\r\n\r\n  return { messages, setMessages, clearSession };\r\n}\r\n","import React, { useState, useCallback } from 'react';\r\nimport type { ChatMessage, ChatMemory } from './chatTypes';\r\n\r\n// A list of common English stop words to filter out from keywords.\r\nconst STOP_WORDS = new Set([\r\n  'i',\r\n  'me',\r\n  'my',\r\n  'myself',\r\n  'we',\r\n  'our',\r\n  'ours',\r\n  'ourselves',\r\n  'you',\r\n  'your',\r\n  'yours',\r\n  'yourself',\r\n  'yourselves',\r\n  'he',\r\n  'him',\r\n  'his',\r\n  'himself',\r\n  'she',\r\n  'her',\r\n  'hers',\r\n  'herself',\r\n  'it',\r\n  'its',\r\n  'itself',\r\n  'they',\r\n  'them',\r\n  'their',\r\n  'theirs',\r\n  'themselves',\r\n  'what',\r\n  'which',\r\n  'who',\r\n  'whom',\r\n  'this',\r\n  'that',\r\n  'these',\r\n  'those',\r\n  'am',\r\n  'is',\r\n  'are',\r\n  'was',\r\n  'were',\r\n  'be',\r\n  'been',\r\n  'being',\r\n  'have',\r\n  'has',\r\n  'had',\r\n  'having',\r\n  'do',\r\n  'does',\r\n  'did',\r\n  'doing',\r\n  'a',\r\n  'an',\r\n  'the',\r\n  'and',\r\n  'but',\r\n  'if',\r\n  'or',\r\n  'because',\r\n  'as',\r\n  'until',\r\n  'while',\r\n  'of',\r\n  'at',\r\n  'by',\r\n  'for',\r\n  'with',\r\n  'about',\r\n  'against',\r\n  'between',\r\n  'into',\r\n  'through',\r\n  'during',\r\n  'before',\r\n  'after',\r\n  'above',\r\n  'below',\r\n  'to',\r\n  'from',\r\n  'up',\r\n  'down',\r\n  'in',\r\n  'out',\r\n  'on',\r\n  'off',\r\n  'over',\r\n  'under',\r\n  'again',\r\n  'further',\r\n  'then',\r\n  'once',\r\n  'here',\r\n  'there',\r\n  'when',\r\n  'where',\r\n  'why',\r\n  'how',\r\n  'all',\r\n  'any',\r\n  'both',\r\n  'each',\r\n  'few',\r\n  'more',\r\n  'most',\r\n  'other',\r\n  'some',\r\n  'such',\r\n  'no',\r\n  'nor',\r\n  'not',\r\n  'only',\r\n  'own',\r\n  'same',\r\n  'so',\r\n  'than',\r\n  'too',\r\n  'very',\r\n  's',\r\n  't',\r\n  'can',\r\n  'will',\r\n  'just',\r\n  'don',\r\n  'should',\r\n  'now',\r\n]);\r\n\r\nconst MIN_KEYWORD_LENGTH = 4;\r\nconst MAX_KEYWORDS = 8;\r\nconst SUMMARY_MAX_LENGTH = 250;\r\n\r\n/**\r\n * A custom hook to manage a client-side \"memory\" of the chat conversation,\r\n * including a summary and extracted keywords.\r\n */\r\nexport function useChatMemory() {\r\n  const [memory, setMemory] = useState<ChatMemory | null>(null);\r\n\r\n  /**\r\n   * Updates the chat memory based on the provided message history.\r\n   * This function extracts meaningful keywords and generates a concise summary.\r\n   */\r\n  const updateMemory = useCallback((messages: readonly ChatMessage[]) => {\r\n    if (messages.length === 0) {\r\n      setMemory(null);\r\n      return;\r\n    }\r\n\r\n    const fullText = messages.map((m) => m.text).join(' ');\r\n\r\n    // --- Enhanced Keyword Extraction ---\r\n    const wordCounts = fullText\r\n      .toLowerCase()\r\n      .match(/\\b\\w+\\b/g) // Tokenize into words\r\n      ?.filter(\r\n        (word) => word.length >= MIN_KEYWORD_LENGTH && !STOP_WORDS.has(word)\r\n      )\r\n      .reduce(\r\n        (acc, word) => {\r\n          acc[word] = (acc[word] || 0) + 1;\r\n          return acc;\r\n        },\r\n        {} as Record<string, number>\r\n      );\r\n\r\n    const keywords = wordCounts\r\n      ? Object.entries(wordCounts)\r\n          .sort(([, a], [, b]) => b - a) // Sort by frequency\r\n          .slice(0, MAX_KEYWORDS)\r\n          .map(([word]) => word)\r\n      : [];\r\n\r\n    // --- Improved Summary Generation ---\r\n    const summary =\r\n      fullText.length > SUMMARY_MAX_LENGTH\r\n        ? `...${fullText.slice(-SUMMARY_MAX_LENGTH)}`\r\n        : fullText;\r\n\r\n    setMemory({ summary, keywords: keywords as readonly string[] });\r\n  }, []);\r\n\r\n  return { memory, updateMemory };\r\n}\r\n","// // TypeScript\r\n// export function formatResponse(text: string) {\r\n//   // Keep Markdown syntax clean and readable\r\n//   return text\r\n//     .replace(/\\n{3,}/g, '\\n\\n') // normalize spacing\r\n//     .trim();\r\n// }\r\n\r\n\r\n\r\n\r\n\r\n/**\r\n * Formats and sanitizes a raw text response, often from an AI,\r\n * to ensure it's clean, readable, and safe for rendering.\r\n * This function is designed to handle markdown-like text by normalizing\r\n * whitespace and ensuring proper spacing around elements like code blocks.\r\n *\r\n * @param text The raw string to format. Can be null or undefined.\r\n * @returns A cleaned and formatted string. Returns an empty string if the input is nullish.\r\n */\r\nexport function formatResponse(text: string | null | undefined): string {\r\n  if (!text) {\r\n    return '';\r\n  }\r\n\r\n  // Normalize line endings to LF\r\n  let formattedText = text.replace(/\\r\\n/g, '\\n');\r\n\r\n  // Ensure there's a newline before and after fenced code blocks\r\n  // This prevents lists or other text from merging with code blocks.\r\n  formattedText = formattedText.replace(/(\\S)(```)/g, '$1\\n$2'); // Before opening fence\r\n  formattedText = formattedText.replace(/(```)(\\S)/g, '$1\\n$2'); // After closing fence\r\n\r\n  // Collapse more than two consecutive newlines into just two.\r\n  // This helps in maintaining clean spacing between paragraphs.\r\n  formattedText = formattedText.replace(/\\n{3,}/g, '\\n\\n');\r\n\r\n  // Trim leading/trailing whitespace from the entire response.\r\n  return formattedText.trim();\r\n}\r\n\r\n\r\n","// @hidden\r\nfunction MessageLoading() {\r\n  return (\r\n    <svg\r\n      width=\"24\"\r\n      height=\"24\"\r\n      viewBox=\"0 0 24 24\"\r\n      xmlns=\"http://www.w3.org/2000/svg\"\r\n      className=\"text-foreground\"\r\n    >\r\n      <circle cx=\"4\" cy=\"12\" r=\"2\" fill=\"white\">\r\n        <animate\r\n          id=\"spinner_qFRN\"\r\n          begin=\"0;spinner_OcgL.end+0.25s\"\r\n          attributeName=\"cy\"\r\n          calcMode=\"spline\"\r\n          dur=\"0.6s\"\r\n          values=\"12;6;12\"\r\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\r\n        />\r\n      </circle>\r\n      <circle cx=\"12\" cy=\"12\" r=\"2\" fill=\"white\">\r\n        <animate\r\n          begin=\"spinner_qFRN.begin+0.1s\"\r\n          attributeName=\"cy\"\r\n          calcMode=\"spline\"\r\n          dur=\"0.6s\"\r\n          values=\"12;6;12\"\r\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\r\n        />\r\n      </circle>\r\n      <circle cx=\"20\" cy=\"12\" r=\"2\" fill=\"white\">\r\n        <animate\r\n          id=\"spinner_OcgL\"\r\n          begin=\"spinner_qFRN.begin+0.2s\"\r\n          attributeName=\"cy\"\r\n          calcMode=\"spline\"\r\n          dur=\"0.6s\"\r\n          values=\"12;6;12\"\r\n          keySplines=\".33,.66,.66,1;.33,0,.66,.33\"\r\n        />\r\n      </circle>\r\n    </svg>\r\n  );\r\n}\r\n\r\nexport { MessageLoading };\r\n","import { motion } from 'framer-motion';\r\nimport { memo } from 'react';\r\nimport { MessageLoading } from './message-loading';\r\n\r\n// Define the possible states for the AI. This makes the component's API clear.\r\nexport type AiStatus =\r\n  | 'idle'\r\n  | 'thinking'\r\n  | 'fetching'\r\n  | 'generating'\r\n  | 'error';\r\n\r\n/**\r\n * A memoized component that displays a loading indicator based on the AI's status.\r\n * It only renders when the AI is actively working ('thinking', 'fetching', 'generating').\r\n */\r\nconst TypingIndicator = memo(({ status }: { status: AiStatus }) => {\r\n  // Do not render anything if the AI is idle or has an error.\r\n  if (status === 'idle' || status === 'error') {\r\n    return null;\r\n  }\r\n\r\n  return (\r\n    <motion.div\r\n      className=\"flex items-center gap-3 px-4 py-3 rounded-xl max-w-[40%] bg-white/10 self-start\"\r\n      initial={{ opacity: 0, y: 10 }}\r\n      animate={{ opacity: 1, y: 0 }}\r\n      exit={{ opacity: 0, y: 10 }}\r\n      transition={{ duration: 0.3, ease: 'easeOut' }}\r\n    >\r\n      <MessageLoading />\r\n    </motion.div>\r\n  );\r\n});\r\n\r\nexport default TypingIndicator;\r\n","'use client';\r\n\r\nimport React, { useState, useRef, useEffect, useCallback } from 'react';\r\nimport { motion } from 'framer-motion';\r\nimport { Trash2, FileText, PanelRightClose, Share2 } from 'lucide-react';\r\nimport { cn } from '@/lib/utils';\r\nimport { runChat } from '@/lib/gemini';\r\nimport ChatInput from './ChatInput';\r\nimport ChatMessageBubble from './ChatMessageBubble';\r\nimport { useChatSession } from '../chat/useChatSession';\r\nimport { useChatMemory } from '../chat/useChatMemory';\r\nimport { formatResponse } from '../chat/formatResponse';\r\nimport type { ChatMessage } from '../chat/chatTypes';\r\nimport TypingIndicator, { AiStatus } from './TypingIndicator';\r\n\r\n// Constants for better maintainability\r\nconst AI_THINKING_DELAY_MS = 500;\r\nconst AI_ERROR_MESSAGE = '‚ö†Ô∏è Something went wrong. Please try again.';\r\n\r\nexport default function AIChatCard({\r\n  className,\r\n  onClose,\r\n}: {\r\n  className?: string;\r\n  onClose?: () => void;\r\n}) {\r\n  const initialMsg: ChatMessage[] = [\r\n    {\r\n      sender: 'ai',\r\n      text: 'üëã Hey there! I‚Äôm your AI assistant. How can I help?',\r\n    },\r\n  ];\r\n\r\n  const { messages, setMessages, clearSession } = useChatSession(initialMsg);\r\n  const { updateMemory } = useChatMemory();\r\n  const [input, setInput] = useState(''); // User input for the chatbox\r\n  const [aiStatus, setAiStatus] = useState<AiStatus>('idle'); // Tracks AI's current state\r\n  const scrollRef = useRef<HTMLDivElement>(null);\r\n\r\n  // Prevent background scroll when chat is open\r\n  useEffect(() => {\r\n    const originalOverflow = document.body.style.overflow;\r\n    document.body.style.overflow = 'hidden';\r\n\r\n    // Cleanup function to restore original scroll style\r\n    return () => {\r\n      document.body.style.overflow = originalOverflow;\r\n    };\r\n  }, []); // Empty dependency array ensures this runs only on mount and unmount\r\n\r\n  // Scroll to bottom on new messages\r\n  useEffect(() => {\r\n    // Effect to scroll to the bottom of the chat on new messages or status changes\r\n    if (scrollRef.current) {\r\n      scrollRef.current.scrollTo({\r\n        top: scrollRef.current.scrollHeight,\r\n        behavior: 'smooth',\r\n      });\r\n    }\r\n  }, [messages, aiStatus]);\r\n\r\n  const handleSend = useCallback(\r\n    async (text?: string) => {\r\n      const trimmed = (text || input).trim();\r\n      if (!trimmed || aiStatus !== 'idle') return; // Prevent sending if AI is busy\r\n\r\n      const userMsg: ChatMessage = {\r\n        sender: 'user',\r\n        text: trimmed,\r\n        timestamp: Date.now(),\r\n      };\r\n\r\n      setMessages((prev) => [...prev, userMsg]);\r\n      setInput(''); // Clear input field\r\n      setAiStatus('thinking'); // AI starts thinking\r\n\r\n      try {\r\n        // Simulate a brief thinking phase before fetching\r\n        await new Promise((resolve) =>\r\n          setTimeout(resolve, AI_THINKING_DELAY_MS)\r\n        );\r\n        const aiText = await runChat([...messages, userMsg]);\r\n        const formatted = formatResponse(aiText);\r\n        const aiMsg: ChatMessage = {\r\n          sender: 'ai',\r\n          text: formatted,\r\n          timestamp: Date.now(),\r\n        };\r\n        setMessages((prev) => [...prev, aiMsg]);\r\n        updateMemory([...messages, userMsg, aiMsg]); // Update chat memory with full context\r\n      } catch (err) {\r\n        console.error('Chat Error:', err);\r\n        const errorMsg: ChatMessage = {\r\n          sender: 'ai',\r\n          text: AI_ERROR_MESSAGE,\r\n          timestamp: Date.now(),\r\n        };\r\n        setMessages((prev) => [...prev, errorMsg]);\r\n        setAiStatus('error'); // Set status to error if something goes wrong\r\n      } finally {\r\n        // Always reset status to idle after processing\r\n        setAiStatus('idle');\r\n      }\r\n    },\r\n    [input, aiStatus, messages, setMessages, updateMemory]\r\n  );\r\n\r\n  const handleExport = useCallback(() => {\r\n    if (!messages.length) return;\r\n\r\n    const now = new Date();\r\n    const fileName = `AI_Chat_${now.toISOString().replace(/[:.]/g, '-')}.txt`;\r\n\r\n    const formatTimestamp = (ts: number | undefined) => {\r\n      if (!ts) return 'N/A';\r\n      return new Date(ts).toLocaleString();\r\n    };\r\n\r\n    const formattedMessages = messages\r\n      .map((msg) => {\r\n        const ts = formatTimestamp(msg.timestamp);\r\n        const sender = msg.sender === 'user' ? 'üßë User' : 'ü§ñ AI';\r\n        return `[${ts}] ${sender}:\\n${msg.text}`;\r\n      })\r\n      .join('\\n--------------------------------------\\n\\n');\r\n\r\n    const header = [\r\n      '===== AI Chat Export =====',\r\n      `Date: ${now.toLocaleDateString()}`,\r\n      `Time: ${now.toLocaleTimeString()}`,\r\n      `Total Messages: ${messages.length}`,\r\n      '======================================',\r\n      '', // Extra newline\r\n    ].join('\\n');\r\n\r\n    const blob = new Blob([header + formattedMessages], { type: 'text/plain' });\r\n    const url = URL.createObjectURL(blob);\r\n    const a = document.createElement('a');\r\n    a.href = url;\r\n    a.download = fileName;\r\n    a.click();\r\n    URL.revokeObjectURL(url);\r\n  }, [messages]);\r\n\r\n  const handleShare = useCallback(async () => {\r\n    if (!messages.length) return;\r\n\r\n    const now = new Date();\r\n    const title = `AI Chat on ${now.toLocaleDateString()}`;\r\n\r\n    const formattedMessages = messages\r\n      .map((msg) => {\r\n        const sender = msg.sender === 'user' ? 'üßë User' : 'ü§ñ AI';\r\n        return `${sender}:\\n${msg.text}`;\r\n      })\r\n      .join('\\n\\n--------------------------------------\\n\\n');\r\n\r\n    const textToShare = `===== ${title} =====\\n\\n${formattedMessages}`;\r\n\r\n    if (navigator.share) {\r\n      try {\r\n        await navigator.share({\r\n          title: title,\r\n          text: textToShare,\r\n        });\r\n      } catch (error) {\r\n        // The user might have cancelled the share action, so we don't need to log an error.\r\n        // If sharing fails for other reasons, the browser console will show it.\r\n        // We can optionally fall back to downloading.\r\n        console.log('Share was cancelled or failed, falling back to download.');\r\n        handleExport();\r\n      }\r\n    } else {\r\n      // Fallback for browsers that don't support the Web Share API\r\n      handleExport();\r\n    }\r\n  }, [messages, handleExport]);\r\n\r\n  return (\r\n    <div\r\n      className={cn(\r\n        'relative w-full h-full rounded-2xl overflow-hidden p-[2px]',\r\n        className\r\n      )}\r\n    >\r\n      {/* Animated Border */}\r\n      <motion.div\r\n        className=\"absolute inset-0 rounded-2xl border-2 border-white/20\"\r\n        animate={{ rotate: [0, 360] }}\r\n        transition={{ duration: 25, repeat: Infinity, ease: 'linear' }}\r\n      />\r\n\r\n      {/* Chat Container */}\r\n      <div className=\"relative flex flex-col w-full h-full rounded-xl border border-white/10 overflow-hidden bg-black/90 backdrop-blur-xl\">\r\n        {/* Header */}\r\n        <div className=\"flex justify-between items-center px-4 py-3 border-b border-white/10 z-10 flex-wrap gap-2\">\r\n          <h2 className=\"text-lg font-semibold text-white\">AI Assistant</h2>\r\n          <div className=\"flex items-center gap-3\">\r\n            <button\r\n              onClick={handleShare}\r\n              className=\"icon-btn\"\r\n              title=\"Share or Export Chat\"\r\n            >\r\n              {/* Using a more appropriate icon for sharing */}\r\n              <Share2 className=\"w-4 h-4\" />\r\n            </button>\r\n            <button\r\n              onClick={handleExport}\r\n              className=\"icon-btn\"\r\n              title=\"Export Chat\"\r\n            >\r\n              <FileText className=\"w-4 h-4\" />\r\n            </button>\r\n            <button\r\n              onClick={clearSession}\r\n              className=\"icon-btn\"\r\n              title=\"Clear Chat\"\r\n            >\r\n              <Trash2 className=\"w-4 h-4\" />\r\n            </button>\r\n            {onClose && (\r\n              <button onClick={onClose} className=\"icon-btn\" title=\"Close Chat\">\r\n                <PanelRightClose className=\"w-4 h-4\" />\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Messages */}\r\n        <div\r\n          ref={scrollRef}\r\n          className=\"flex-1 px-4 py-3 overflow-y-auto space-y-3 text-sm flex flex-col relative z-10\"\r\n        >\r\n          {messages.map((msg, i) => (\r\n            <ChatMessageBubble\r\n              key={i}\r\n              msg={msg}\r\n              onRegenerate={() => handleSend(msg.text)}\r\n            />\r\n          ))}\r\n\r\n          {/* Render the enhanced TypingIndicator based on aiStatus */}\r\n          <TypingIndicator status={aiStatus} />\r\n        </div>\r\n\r\n        {/* Input Box - disabled when AI is busy */}\r\n        <ChatInput\r\n          value={input}\r\n          onChange={setInput}\r\n          onSend={() => handleSend()}\r\n          disabled={aiStatus !== 'idle' || !input.trim()}\r\n        />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":["API_URL","delay","ms","resolve","runChat","chatHistory","messages","msg","attempts","maxRetries","controller","timeout","response","err","ChatInput","value","onChange","onSend","disabled","jsxs","jsx","e","cn","Send","CodeBlock","memo","inline","className","children","copied","setCopied","useState","match","codeString","handleCopyCode","Check","Copy","SyntaxHighlighter","vscDarkPlus","ChatMessageBubble","onRegenerate","allMessages","isAI","liked","setLiked","disliked","setDisliked","isSpeaking","setIsSpeaking","handleCopy","handleCopyAll","text","m","handleSpeak","utter","voices","preferredVoice","voice","motion","ReactMarkdown","rehypeRaw","remarkGfm","Fragment","ThumbsUp","ThumbsDown","RefreshCw","X","Volume2","STORAGE_KEY","useChatSession","initialMessages","setMessages","saved","parsed","error","useEffect","clearSession","useCallback","STOP_WORDS","MIN_KEYWORD_LENGTH","MAX_KEYWORDS","SUMMARY_MAX_LENGTH","useChatMemory","memory","setMemory","updateMemory","fullText","wordCounts","word","acc","keywords","a","b","summary","formatResponse","formattedText","MessageLoading","TypingIndicator","status","AI_THINKING_DELAY_MS","AI_ERROR_MESSAGE","AIChatCard","onClose","initialMsg","input","setInput","aiStatus","setAiStatus","scrollRef","useRef","originalOverflow","handleSend","trimmed","userMsg","prev","aiText","aiMsg","errorMsg","handleExport","now","fileName","formatTimestamp","ts","formattedMessages","sender","header","blob","url","handleShare","title","textToShare","Share2","FileText","Trash2","PanelRightClose","i"],"mappings":"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,EAAIxC,EAAAA,SAAwB,IAAM,CAE5D,GAAI,OAAO,OAAW,IACpB,GAAI,CACF,MAAMyC,EAAQ,eAAe,QAAQJ,CAAW,EAChD,GAAII,EAAO,CACT,MAAMC,EAAS,KAAK,MAAMD,CAAK,EAE/B,GAAI,MAAM,QAAQC,CAAM,EACtB,OAAOA,CAEX,CACF,OAASC,EAAO,CACd,QAAQ,MACN,oDACAA,CAAA,EAGF,eAAe,WAAWN,CAAW,CACvC,CAGF,MAAO,CAAC,GAAGE,CAAe,CAC5B,CAAC,EAGDK,EAAAA,UAAU,IAAM,CACd,GAAI,CACF,eAAe,QAAQP,EAAa,KAAK,UAAU9D,CAAQ,CAAC,CAC9D,OAASoE,EAAO,CACd,QAAQ,MAAM,iDAAkDA,CAAK,CACvE,CACF,EAAG,CAACpE,CAAQ,CAAC,EAMb,MAAMsE,EAAeC,EAAAA,YAAY,IAAM,CACrC,GAAI,CACF,eAAe,WAAWT,CAAW,EACrCG,EAAY,CAAC,GAAGD,CAAe,CAAC,CAClC,OAASI,EAAO,CACd,QAAQ,MAAM,oDAAqDA,CAAK,CAC1E,CACF,EAAG,CAACJ,CAAe,CAAC,EAEpB,MAAO,CAAE,SAAAhE,EAAU,YAAAiE,EAAa,aAAAK,CAAA,CAClC,CCzDA,MAAME,OAAiB,IAAI,CACzB,IACA,KACA,KACA,SACA,KACA,MACA,OACA,YACA,MACA,OACA,QACA,WACA,aACA,KACA,MACA,MACA,UACA,MACA,MACA,OACA,UACA,KACA,MACA,SACA,OACA,OACA,QACA,SACA,aACA,OACA,QACA,MACA,OACA,OACA,OACA,QACA,QACA,KACA,KACA,MACA,MACA,OACA,KACA,OACA,QACA,OACA,MACA,MACA,SACA,KACA,OACA,MACA,QACA,IACA,KACA,MACA,MACA,MACA,KACA,KACA,UACA,KACA,QACA,QACA,KACA,KACA,KACA,MACA,OACA,QACA,UACA,UACA,OACA,UACA,SACA,SACA,QACA,QACA,QACA,KACA,OACA,KACA,OACA,KACA,MACA,KACA,MACA,OACA,QACA,QACA,UACA,OACA,OACA,OACA,QACA,OACA,QACA,MACA,MACA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"}