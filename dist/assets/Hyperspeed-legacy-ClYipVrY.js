!function(){function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=function(e,t){if("object"!=_typeof(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_typeof(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_typeof(t)?t:t+""}System.register(["./vendor_react-legacy-6VxedhaZ.js","./vendor-legacy-_CNXLam7.js","./vendor_react-dom-legacy-FKbmXNA2.js"],function(e,t){"use strict";var n,r,i,o,s,a,u,h,c,l,f,d,p,v,g,m,y,w,P,x,b,L,S,M,F,D,k;return{setters:[function(e){n=e.a,r=e.j},function(e){i=e.aF,o=e.aE,s=e.am,a=e.c1,u=e.ap,h=e.aq,c=e.c2,l=e.aG,f=e.c3,d=e.c4,p=e.c5,v=e.c6,g=e.c7,m=e.c8,y=e.bd,w=e.aB,P=e.c9,x=e.bk,b=e.ca,L=e.cb,S=e.cc,M=e.cd,F=e.ce,D=e.cf,k=e.cg},null],execute:function(){e("default",function(e){var t=e.effectOptions,T=void 0===t?{onSpeedUp:function(){},onSlowDown:function(){},distortion:"turbulentDistortion",length:400,roadWidth:10,islandWidth:2,lanesPerRoad:4,fov:90,fovSpeedUp:150,speedUp:2,carLightsFade:.4,totalSideLightSticks:20,lightPairsPerRoadWay:40,shoulderLinesWidthPercentage:.05,brokenLinesWidthPercentage:.1,brokenLinesLengthPercentage:.5,lightStickWidth:[.12,.5],lightStickHeight:[1.3,1.7],movingAwaySpeed:[60,80],movingCloserSpeed:[-120,-160],carLightsLength:[12,80],carLightsRadius:[.05,.14],carWidthPercentage:[.3,.5],carShiftX:[-.8,.8],carFloorSeparation:[0,5],colors:{roadColor:526344,islandColor:657930,background:0,shoulderLines:16777215,brokenLines:16777215,leftCars:[14177983,6770850,12732332],rightCars:[242627,941733,3294549],sticks:242627}}:t,C=n.useRef(null),A=n.useRef(null);return n.useEffect(function(){if(A.current){A.current.dispose();var e=document.getElementById("lights");if(e)for(;e.firstChild;)e.removeChild(e.firstChild)}var t={uFreq:{value:new i(3,6,10)},uAmp:{value:new i(30,30,20)}},n={uFreq:{value:new o(5,2)},uAmp:{value:new o(25,15)}},r={uFreq:{value:new o(2,3)},uAmp:{value:new o(35,10)}},C={uFreq:{value:new k(4,8,8,1)},uAmp:{value:new k(25,5,10,10)}},I={uFreq:{value:new o(4,8)},uAmp:{value:new o(10,20)},uPowY:{value:new o(20,2)}},nsin=function(e){return.5*Math.sin(e)+.5},_={mountainDistortion:{uniforms:t,getDistortion:"\n          uniform vec3 uAmp;\n          uniform vec3 uFreq;\n          #define PI 3.14159265358979\n          float nsin(float val){\n            return sin(val) * 0.5 + 0.5;\n          }\n          vec3 getDistortion(float progress){\n            float movementProgressFix = 0.02;\n            return vec3( \n              cos(progress * PI * uFreq.x + uTime) * uAmp.x - cos(movementProgressFix * PI * uFreq.x + uTime) * uAmp.x,\n              nsin(progress * PI * uFreq.y + uTime) * uAmp.y - nsin(movementProgressFix * PI * uFreq.y + uTime) * uAmp.y,\n              nsin(progress * PI * uFreq.z + uTime) * uAmp.z - nsin(movementProgressFix * PI * uFreq.z + uTime) * uAmp.z\n            );\n          }\n        ",getJS:function(e,n){var r=.02,o=t.uFreq.value,s=t.uAmp.value,a=new i(Math.cos(e*Math.PI*o.x+n)*s.x-Math.cos(r*Math.PI*o.x+n)*s.x,nsin(e*Math.PI*o.y+n)*s.y-nsin(r*Math.PI*o.y+n)*s.y,nsin(e*Math.PI*o.z+n)*s.z-nsin(r*Math.PI*o.z+n)*s.z),u=new i(2,2,2),h=new i(0,0,-5);return a.multiply(u).add(h)}},xyDistortion:{uniforms:n,getDistortion:"\n          uniform vec2 uFreq;\n          uniform vec2 uAmp;\n          #define PI 3.14159265358979\n          vec3 getDistortion(float progress){\n            float movementProgressFix = 0.02;\n            return vec3( \n              cos(progress * PI * uFreq.x + uTime) * uAmp.x - cos(movementProgressFix * PI * uFreq.x + uTime) * uAmp.x,\n              sin(progress * PI * uFreq.y + PI/2. + uTime) * uAmp.y - sin(movementProgressFix * PI * uFreq.y + PI/2. + uTime) * uAmp.y,\n              0.\n            );\n          }\n        ",getJS:function(e,t){var r=n.uFreq.value,o=n.uAmp.value,s=new i(Math.cos(e*Math.PI*r.x+t)*o.x-Math.cos(.02*Math.PI*r.x+t)*o.x,Math.sin(e*Math.PI*r.y+t+Math.PI/2)*o.y-Math.sin(.02*Math.PI*r.y+t+Math.PI/2)*o.y,0),a=new i(2,.4,1),u=new i(0,0,-3);return s.multiply(a).add(u)}},LongRaceDistortion:{uniforms:r,getDistortion:"\n          uniform vec2 uFreq;\n          uniform vec2 uAmp;\n          #define PI 3.14159265358979\n          vec3 getDistortion(float progress){\n            float camProgress = 0.0125;\n            return vec3( \n              sin(progress * PI * uFreq.x + uTime) * uAmp.x - sin(camProgress * PI * uFreq.x + uTime) * uAmp.x,\n              sin(progress * PI * uFreq.y + uTime) * uAmp.y - sin(camProgress * PI * uFreq.y + uTime) * uAmp.y,\n              0.\n            );\n          }\n        ",getJS:function(e,t){var n=.0125,o=r.uFreq.value,s=r.uAmp.value,a=new i(Math.sin(e*Math.PI*o.x+t)*s.x-Math.sin(n*Math.PI*o.x+t)*s.x,Math.sin(e*Math.PI*o.y+t)*s.y-Math.sin(n*Math.PI*o.y+t)*s.y,0),u=new i(1,1,0),h=new i(0,0,-5);return a.multiply(u).add(h)}},turbulentDistortion:{uniforms:C,getDistortion:"\n          uniform vec4 uFreq;\n          uniform vec4 uAmp;\n          float nsin(float val){\n            return sin(val) * 0.5 + 0.5;\n          }\n          #define PI 3.14159265358979\n          float getDistortionX(float progress){\n            return (\n              cos(PI * progress * uFreq.r + uTime) * uAmp.r +\n              pow(cos(PI * progress * uFreq.g + uTime * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\n            );\n          }\n          float getDistortionY(float progress){\n            return (\n              -nsin(PI * progress * uFreq.b + uTime) * uAmp.b +\n              -pow(nsin(PI * progress * uFreq.a + uTime / (uFreq.b / uFreq.a)), 5.) * uAmp.a\n            );\n          }\n          vec3 getDistortion(float progress){\n            return vec3(\n              getDistortionX(progress) - getDistortionX(0.0125),\n              getDistortionY(progress) - getDistortionY(0.0125),\n              0.\n            );\n          }\n        ",getJS:function(e,t){var n=C.uFreq.value,r=C.uAmp.value,getX=function(e){return Math.cos(Math.PI*e*n.x+t)*r.x+Math.pow(Math.cos(Math.PI*e*n.y+t*(n.y/n.x)),2)*r.y},getY=function(e){return-nsin(Math.PI*e*n.z+t)*r.z-Math.pow(nsin(Math.PI*e*n.w+t/(n.z/n.w)),5)*r.w},o=new i(getX(e)-getX(e+.007),getY(e)-getY(e+.007),0),s=new i(-2,-5,0),a=new i(0,0,-10);return o.multiply(s).add(a)}},turbulentDistortionStill:{uniforms:C,getDistortion:"\n          uniform vec4 uFreq;\n          uniform vec4 uAmp;\n          float nsin(float val){\n            return sin(val) * 0.5 + 0.5;\n          }\n          #define PI 3.14159265358979\n          float getDistortionX(float progress){\n            return (\n              cos(PI * progress * uFreq.r) * uAmp.r +\n              pow(cos(PI * progress * uFreq.g * (uFreq.g / uFreq.r)), 2. ) * uAmp.g\n            );\n          }\n          float getDistortionY(float progress){\n            return (\n              -nsin(PI * progress * uFreq.b) * uAmp.b +\n              -pow(nsin(PI * progress * uFreq.a / (uFreq.b / uFreq.a)), 5.) * uAmp.a\n            );\n          }\n          vec3 getDistortion(float progress){\n            return vec3(\n              getDistortionX(progress) - getDistortionX(0.02),\n              getDistortionY(progress) - getDistortionY(0.02),\n              0.\n            );\n          }\n        "},deepDistortionStill:{uniforms:I,getDistortion:"\n          uniform vec4 uFreq;\n          uniform vec4 uAmp;\n          uniform vec2 uPowY;\n          float nsin(float val){\n            return sin(val) * 0.5 + 0.5;\n          }\n          #define PI 3.14159265358979\n          float getDistortionX(float progress){\n            return (\n              sin(progress * PI * uFreq.x) * uAmp.x * 2.\n            );\n          }\n          float getDistortionY(float progress){\n            return (\n              pow(abs(progress * uPowY.x), uPowY.y) + sin(progress * PI * uFreq.y) * uAmp.y\n            );\n          }\n          vec3 getDistortion(float progress){\n            return vec3(\n              getDistortionX(progress) - getDistortionX(0.02),\n              getDistortionY(progress) - getDistortionY(0.05),\n              0.\n            );\n          }\n        "},deepDistortion:{uniforms:I,getDistortion:"\n          uniform vec4 uFreq;\n          uniform vec4 uAmp;\n          uniform vec2 uPowY;\n          float nsin(float val){\n            return sin(val) * 0.5 + 0.5;\n          }\n          #define PI 3.14159265358979\n          float getDistortionX(float progress){\n            return (\n              sin(progress * PI * uFreq.x + uTime) * uAmp.x\n            );\n          }\n          float getDistortionY(float progress){\n            return (\n              pow(abs(progress * uPowY.x), uPowY.y) + sin(progress * PI * uFreq.y + uTime) * uAmp.y\n            );\n          }\n          vec3 getDistortion(float progress){\n            return vec3(\n              getDistortionX(progress) - getDistortionX(0.02),\n              getDistortionY(progress) - getDistortionY(0.02),\n              0.\n            );\n          }\n        ",getJS:function(e,t){var n=I.uFreq.value,r=I.uAmp.value,o=I.uPowY.value,getX=function(e){return Math.sin(e*Math.PI*n.x+t)*r.x},getY=function(e){return Math.pow(e*o.x,o.y)+Math.sin(e*Math.PI*n.y+t)*r.y},s=new i(getX(e)-getX(e+.01),getY(e)-getY(e+.01),0),a=new i(-2,-4,0),u=new i(0,0,-10);return s.multiply(a).add(u)}}},q=function(){return _createClass(function App(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};_classCallCheck(this,App),this.options=t,null==this.options.distortion&&(this.options.distortion={uniforms:U,getDistortion:W}),this.container=e,this.renderer=new s({antialias:!1,alpha:!0}),this.renderer.setSize(e.offsetWidth,e.offsetHeight,!1),this.renderer.setPixelRatio(window.devicePixelRatio),this.composer=new a(this.renderer),e.append(this.renderer.domElement),this.camera=new u(t.fov,e.offsetWidth/e.offsetHeight,.1,1e4),this.camera.position.z=-5,this.camera.position.y=8,this.camera.position.x=0,this.scene=new h,this.scene.background=null;var n=new c(t.colors.background,.2*t.length,500*t.length);this.scene.fog=n,this.fogUniforms={fogColor:{value:n.color},fogNear:{value:n.near},fogFar:{value:n.far}},this.clock=new l,this.assets={},this.disposed=!1,this.road=new X(this,t),this.leftCarLights=new E(this,t,t.colors.leftCars,t.movingAwaySpeed,new o(0,1-t.carLightsFade)),this.rightCarLights=new E(this,t,t.colors.rightCars,t.movingCloserSpeed,new o(1,0+t.carLightsFade)),this.leftSticks=new j(this,t),this.fovTarget=t.fov,this.speedUpTarget=0,this.speedUp=0,this.timeOffset=0,this.tick=this.tick.bind(this),this.init=this.init.bind(this),this.setSize=this.setSize.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onContextMenu=this.onContextMenu.bind(this),window.addEventListener("resize",this.onWindowResize.bind(this))},[{key:"onWindowResize",value:function(){var e=this.container.offsetWidth,t=this.container.offsetHeight;this.renderer.setSize(e,t),this.camera.aspect=e/t,this.camera.updateProjectionMatrix(),this.composer.setSize(e,t)}},{key:"initPasses",value:function(){this.renderPass=new f(this.scene,this.camera),this.bloomPass=new d(this.camera,new p({luminanceThreshold:.2,luminanceSmoothing:0,resolutionScale:1}));var e=new d(this.camera,new v({preset:g.MEDIUM,searchImage:v.searchImageDataURL,areaImage:v.areaImageDataURL}));this.renderPass.renderToScreen=!1,this.bloomPass.renderToScreen=!1,e.renderToScreen=!0,this.composer.addPass(this.renderPass),this.composer.addPass(this.bloomPass),this.composer.addPass(e)}},{key:"loadAssets",value:function(){var e=this.assets;return new Promise(function(t){var n=new m(t),r=new Image,i=new Image;e.smaa={},r.addEventListener("load",function(){e.smaa.search=this,n.itemEnd("smaa-search")}),i.addEventListener("load",function(){e.smaa.area=this,n.itemEnd("smaa-area")}),n.itemStart("smaa-search"),n.itemStart("smaa-area"),r.src=v.searchImageDataURL,i.src=v.areaImageDataURL})}},{key:"init",value:function(){this.initPasses();var e=this.options;this.road.init(),this.leftCarLights.init(),this.leftCarLights.mesh.position.setX(-e.roadWidth/2-e.islandWidth/2),this.rightCarLights.init(),this.rightCarLights.mesh.position.setX(e.roadWidth/2+e.islandWidth/2),this.leftSticks.init(),this.leftSticks.mesh.position.setX(-(e.roadWidth+e.islandWidth/2)),this.container.addEventListener("mousedown",this.onMouseDown),this.container.addEventListener("mouseup",this.onMouseUp),this.container.addEventListener("mouseout",this.onMouseUp),this.container.addEventListener("touchstart",this.onTouchStart,{passive:!0}),this.container.addEventListener("touchend",this.onTouchEnd,{passive:!0}),this.container.addEventListener("touchcancel",this.onTouchEnd,{passive:!0}),this.container.addEventListener("contextmenu",this.onContextMenu),this.tick()}},{key:"onMouseDown",value:function(e){this.options.onSpeedUp&&this.options.onSpeedUp(e),this.fovTarget=this.options.fovSpeedUp,this.speedUpTarget=this.options.speedUp}},{key:"onMouseUp",value:function(e){this.options.onSlowDown&&this.options.onSlowDown(e),this.fovTarget=this.options.fov,this.speedUpTarget=0}},{key:"onTouchStart",value:function(e){this.options.onSpeedUp&&this.options.onSpeedUp(e),this.fovTarget=this.options.fovSpeedUp,this.speedUpTarget=this.options.speedUp}},{key:"onTouchEnd",value:function(e){this.options.onSlowDown&&this.options.onSlowDown(e),this.fovTarget=this.options.fov,this.speedUpTarget=0}},{key:"onContextMenu",value:function(e){e.preventDefault()}},{key:"update",value:function(e){var t=Math.exp(60*Math.log2(.9)*e);this.speedUp+=lerp(this.speedUp,this.speedUpTarget,t,1e-5),this.timeOffset+=this.speedUp*e;var n=this.clock.elapsedTime+this.timeOffset;this.rightCarLights.update(n),this.leftCarLights.update(n),this.leftSticks.update(n),this.road.update(n);var r=!1,o=lerp(this.camera.fov,this.fovTarget,t);if(0!==o&&(this.camera.fov+=o*e*6,r=!0),this.options.distortion.getJS){var s=this.options.distortion.getJS(.025,n);this.camera.lookAt(new i(this.camera.position.x+s.x,this.camera.position.y+s.y,this.camera.position.z+s.z)),r=!0}r&&this.camera.updateProjectionMatrix(),this.options.isHyper}},{key:"render",value:function(e){this.composer.render(e)}},{key:"dispose",value:function(){this.disposed=!0,this.renderer&&this.renderer.dispose(),this.composer&&this.composer.dispose(),this.scene&&this.scene.clear(),window.removeEventListener("resize",this.onWindowResize.bind(this)),this.container&&(this.container.removeEventListener("mousedown",this.onMouseDown),this.container.removeEventListener("mouseup",this.onMouseUp),this.container.removeEventListener("mouseout",this.onMouseUp),this.container.removeEventListener("touchstart",this.onTouchStart),this.container.removeEventListener("touchend",this.onTouchEnd),this.container.removeEventListener("touchcancel",this.onTouchEnd),this.container.removeEventListener("contextmenu",this.onContextMenu))}},{key:"setSize",value:function(e,t,n){this.composer.setSize(e,t,n)}},{key:"tick",value:function(){if(!this.disposed&&this){if(function(e,t){var n=e.domElement,r=n.clientWidth,i=n.clientHeight,o=n.width!==r||n.height!==i;o&&t(r,i,!1);return o}(this.renderer,this.setSize)){var e=this.renderer.domElement;this.camera.aspect=e.clientWidth/e.clientHeight,this.camera.updateProjectionMatrix()}var t=this.clock.getDelta();this.render(t),this.update(t),requestAnimationFrame(this.tick)}}}])}(),U={uDistortionX:{value:new o(80,3)},uDistortionY:{value:new o(-40,2.5)}},W="\n      #define PI 3.14159265358979\n      uniform vec2 uDistortionX;\n      uniform vec2 uDistortionY;\n      float nsin(float val){\n        return sin(val) * 0.5 + 0.5;\n      }\n      vec3 getDistortion(float progress){\n        progress = clamp(progress, 0., 1.);\n        float xAmp = uDistortionX.r;\n        float xFreq = uDistortionX.g;\n        float yAmp = uDistortionY.r;\n        float yFreq = uDistortionY.g;\n        return vec3( \n          xAmp * nsin(progress * PI * xFreq - PI / 2.),\n          yAmp * nsin(progress * PI * yFreq - PI / 2.),\n          0.\n        );\n      }\n    ",random=function(e){return Array.isArray(e)?Math.random()*(e[1]-e[0])+e[0]:Math.random()*e},pickRandom=function(e){return Array.isArray(e)?e[Math.floor(Math.random()*e.length)]:e};function lerp(e,t){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.001,r=(t-e)*(arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1);return Math.abs(r)<n&&(r=t-e),r}var E=function(){return _createClass(function CarLights(e,t,n,r,i){_classCallCheck(this,CarLights),this.webgl=e,this.options=t,this.colors=n,this.speed=r,this.fade=i},[{key:"init",value:function(){var e=this.options,t=new S(new i(0,0,0),new i(0,0,-1)),n=new M(t,40,1,8,!1),r=(new F).copy(n);r.instanceCount=2*e.lightPairsPerRoadWay;var o=e.roadWidth/e.lanesPerRoad,s=[],a=[],u=[],h=this.colors;h=Array.isArray(h)?h.map(function(e){return new w(e)}):new w(h);for(var c=0;c<e.lightPairsPerRoadWay;c++){var l=random(e.carLightsRadius),f=random(e.carLightsLength),d=random(this.speed),p=c%e.lanesPerRoad*o-e.roadWidth/2+o/2,v=random(e.carWidthPercentage)*o;p+=random(e.carShiftX)*o;var g=random(e.carFloorSeparation)+1.3*l,m=-random(e.length);s.push(p-v/2),s.push(g),s.push(m),s.push(p+v/2),s.push(g),s.push(m),a.push(l),a.push(f),a.push(d),a.push(l),a.push(f),a.push(d);var y=pickRandom(h);u.push(y.r),u.push(y.g),u.push(y.b),u.push(y.r),u.push(y.g),u.push(y.b)}r.setAttribute("aOffset",new D(new Float32Array(s),3,!1)),r.setAttribute("aMetrics",new D(new Float32Array(a),3,!1)),r.setAttribute("aColor",new D(new Float32Array(u),3,!1));var x=new P({fragmentShader:z,vertexShader:O,transparent:!0,uniforms:Object.assign({uTime:{value:0},uTravelLength:{value:e.length},uFade:{value:this.fade}},this.webgl.fogUniforms,e.distortion.uniforms)});x.onBeforeCompile=function(t){t.vertexShader=t.vertexShader.replace("#include <getDistortion_vertex>",e.distortion.getDistortion)};var b=new L(r,x);b.frustumCulled=!1,this.webgl.scene.add(b),this.mesh=b}},{key:"update",value:function(e){this.mesh.material.uniforms.uTime.value=e}}])}(),z="\n      #define USE_FOG;\n      ".concat(b.fog_pars_fragment,"\n      varying vec3 vColor;\n      varying vec2 vUv; \n      uniform vec2 uFade;\n      void main() {\n        vec3 color = vec3(vColor);\n        float alpha = smoothstep(uFade.x, uFade.y, vUv.x);\n        gl_FragColor = vec4(color, alpha);\n        if (gl_FragColor.a < 0.0001) discard;\n        ").concat(b.fog_fragment,"\n      }\n    "),O="\n      #define USE_FOG;\n      ".concat(b.fog_pars_vertex,"\n      attribute vec3 aOffset;\n      attribute vec3 aMetrics;\n      attribute vec3 aColor;\n      uniform float uTravelLength;\n      uniform float uTime;\n      varying vec2 vUv; \n      varying vec3 vColor; \n      #include <getDistortion_vertex>\n      void main() {\n        vec3 transformed = position.xyz;\n        float radius = aMetrics.r;\n        float myLength = aMetrics.g;\n        float speed = aMetrics.b;\n\n        transformed.xy *= radius;\n        transformed.z *= myLength;\n\n        transformed.z += myLength - mod(uTime * speed + aOffset.z, uTravelLength);\n        transformed.xy += aOffset.xy;\n\n        float progress = abs(transformed.z / uTravelLength);\n        transformed.xyz += getDistortion(progress);\n\n        vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n        gl_Position = projectionMatrix * mvPosition;\n        vUv = uv;\n        vColor = aColor;\n        ").concat(b.fog_vertex,"\n      }\n    "),j=function(){return _createClass(function LightsSticks(e,t){_classCallCheck(this,LightsSticks),this.webgl=e,this.options=t},[{key:"init",value:function(){var e=this.options,t=new y(1,1),n=(new F).copy(t),r=e.totalSideLightSticks;n.instanceCount=r;var i=e.length/(r-1),o=[],s=[],a=[],u=e.colors.sticks;u=Array.isArray(u)?u.map(function(e){return new w(e)}):new w(u);for(var h=0;h<r;h++){var c=random(e.lightStickWidth),l=random(e.lightStickHeight);o.push((h-1)*i*2+i*Math.random());var f=pickRandom(u);s.push(f.r),s.push(f.g),s.push(f.b),a.push(c),a.push(l)}n.setAttribute("aOffset",new D(new Float32Array(o),1,!1)),n.setAttribute("aColor",new D(new Float32Array(s),3,!1)),n.setAttribute("aMetrics",new D(new Float32Array(a),2,!1));var d=new P({fragmentShader:R,vertexShader:Y,side:x,uniforms:Object.assign({uTravelLength:{value:e.length},uTime:{value:0}},this.webgl.fogUniforms,e.distortion.uniforms)});d.onBeforeCompile=function(t){t.vertexShader=t.vertexShader.replace("#include <getDistortion_vertex>",e.distortion.getDistortion)};var p=new L(n,d);p.frustumCulled=!1,this.webgl.scene.add(p),this.mesh=p}},{key:"update",value:function(e){this.mesh.material.uniforms.uTime.value=e}}])}(),Y="\n      #define USE_FOG;\n      ".concat(b.fog_pars_vertex,"\n      attribute float aOffset;\n      attribute vec3 aColor;\n      attribute vec2 aMetrics;\n      uniform float uTravelLength;\n      uniform float uTime;\n      varying vec3 vColor;\n      mat4 rotationY( in float angle ) {\n        return mat4(\tcos(angle),\t\t0,\t\tsin(angle),\t0,\n                     0,\t\t1.0,\t\t\t 0,\t0,\n                -sin(angle),\t0,\t\tcos(angle),\t0,\n                0, \t\t0,\t\t\t\t0,\t1);\n      }\n      #include <getDistortion_vertex>\n      void main(){\n        vec3 transformed = position.xyz;\n        float width = aMetrics.x;\n        float height = aMetrics.y;\n\n        transformed.xy *= vec2(width, height);\n        float time = mod(uTime * 60. * 2. + aOffset, uTravelLength);\n\n        transformed = (rotationY(3.14/2.) * vec4(transformed,1.)).xyz;\n\n        transformed.z += - uTravelLength + time;\n\n        float progress = abs(transformed.z / uTravelLength);\n        transformed.xyz += getDistortion(progress);\n\n        transformed.y += height / 2.;\n        transformed.x += -width / 2.;\n        vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n        gl_Position = projectionMatrix * mvPosition;\n        vColor = aColor;\n        ").concat(b.fog_vertex,"\n      }\n    "),R="\n      #define USE_FOG;\n      ".concat(b.fog_pars_fragment,"\n      varying vec3 vColor;\n      void main(){\n        vec3 color = vec3(vColor);\n        gl_FragColor = vec4(color,1.);\n        ").concat(b.fog_fragment,"\n      }\n    "),X=function(){return _createClass(function Road(e,t){_classCallCheck(this,Road),this.webgl=e,this.options=t,this.uTime={value:0}},[{key:"createPlane",value:function(e,t,n){var r=this.options,i=new y(n?r.roadWidth:r.islandWidth,r.length,20,100),o={uTravelLength:{value:r.length},uColor:{value:new w(n?r.colors.roadColor:r.colors.islandColor)},uTime:this.uTime};n&&(o=Object.assign(o,{uLanes:{value:r.lanesPerRoad},uBrokenLinesColor:{value:new w(r.colors.brokenLines)},uShoulderLinesColor:{value:new w(r.colors.shoulderLines)},uShoulderLinesWidthPercentage:{value:r.shoulderLinesWidthPercentage},uBrokenLinesLengthPercentage:{value:r.brokenLinesLengthPercentage},uBrokenLinesWidthPercentage:{value:r.brokenLinesWidthPercentage}}));var s=new P({fragmentShader:n?G:H,vertexShader:J,side:x,uniforms:Object.assign(o,this.webgl.fogUniforms,r.distortion.uniforms)});s.onBeforeCompile=function(e){e.vertexShader=e.vertexShader.replace("#include <getDistortion_vertex>",r.distortion.getDistortion)};var a=new L(i,s);return a.rotation.x=-Math.PI/2,a.position.z=-r.length/2,a.position.x+=(this.options.islandWidth/2+r.roadWidth/2)*e,this.webgl.scene.add(a),a}},{key:"init",value:function(){this.leftRoadWay=this.createPlane(-1,this.options.roadWidth,!0),this.rightRoadWay=this.createPlane(1,this.options.roadWidth,!0),this.island=this.createPlane(0,this.options.islandWidth,!1)}},{key:"update",value:function(e){this.uTime.value=e}}])}(),B="\n      #define USE_FOG;\n      varying vec2 vUv; \n      uniform vec3 uColor;\n      uniform float uTime;\n      #include <roadMarkings_vars>\n      ".concat(b.fog_pars_fragment,"\n      void main() {\n        vec2 uv = vUv;\n        vec3 color = vec3(uColor);\n        #include <roadMarkings_fragment>\n        gl_FragColor = vec4(color, 1.);\n        ").concat(b.fog_fragment,"\n      }\n    "),H=B.replace("#include <roadMarkings_fragment>","").replace("#include <roadMarkings_vars>",""),G=B.replace("#include <roadMarkings_fragment>","\n      uv.y = mod(uv.y + uTime * 0.05, 1.);\n      float laneWidth = 1.0 / uLanes;\n      float brokenLineWidth = laneWidth * uBrokenLinesWidthPercentage;\n      float laneEmptySpace = 1. - uBrokenLinesLengthPercentage;\n\n      float brokenLines = step(1.0 - brokenLineWidth, fract(uv.x * 2.0)) * step(laneEmptySpace, fract(uv.y * 10.0));\n      float sideLines = step(1.0 - brokenLineWidth, fract((uv.x - laneWidth * (uLanes - 1.0)) * 2.0)) + step(brokenLineWidth, uv.x);\n\n      brokenLines = mix(brokenLines, sideLines, uv.x);\n    ").replace("#include <roadMarkings_vars>","\n      uniform float uLanes;\n      uniform vec3 uBrokenLinesColor;\n      uniform vec3 uShoulderLinesColor;\n      uniform float uShoulderLinesWidthPercentage;\n      uniform float uBrokenLinesWidthPercentage;\n      uniform float uBrokenLinesLengthPercentage;\n      highp float random(vec2 co) {\n        highp float a = 12.9898;\n        highp float b = 78.233;\n        highp float c = 43758.5453;\n        highp float dt = dot(co.xy, vec2(a, b));\n        highp float sn = mod(dt, 3.14);\n        return fract(sin(sn) * c);\n      }\n    "),J="\n      #define USE_FOG;\n      uniform float uTime;\n      ".concat(b.fog_pars_vertex,"\n      uniform float uTravelLength;\n      varying vec2 vUv; \n      #include <getDistortion_vertex>\n      void main() {\n        vec3 transformed = position.xyz;\n        vec3 distortion = getDistortion((transformed.y + uTravelLength / 2.) / uTravelLength);\n        transformed.x += distortion.x;\n        transformed.z += distortion.y;\n        transformed.y += -1. * distortion.z;  \n        \n        vec4 mvPosition = modelViewMatrix * vec4(transformed, 1.);\n        gl_Position = projectionMatrix * mvPosition;\n        vUv = uv;\n        ").concat(b.fog_vertex,"\n      }\n    ");return function(){var e=document.getElementById("lights"),t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}({},T);t.distortion=_[t.distortion];var n=new q(e,t);A.current=n,n.loadAssets().then(n.init)}(),function(){A.current&&A.current.dispose()}},[T]),r.jsx("div",{id:"lights",className:"w-full h-full",ref:C})})}}})}();
