import{r as e,j as s,m as t,bv as a,bw as n,bx as i,by as o,bz as c,bA as r,bB as l,bC as p,bD as d,bE as h,X as b,bF as u}from"./vendor-CYRj25Sh.js";import{c as m}from"./utils-DmuLVXx7.js";function useCopyToClipboard(s=2e3){const[t,a]=e.useState(!1);return{copied:t,copy:e.useCallback(e=>{navigator.clipboard.writeText(e).then(()=>{a(!0),setTimeout(()=>{a(!1)},s)})},[s])}}const g=e.memo(({inline:e,className:t,children:a})=>{const{copied:n,copy:i}=useCopyToClipboard(),o=/language-(\w+)/.exec(t||"");String(a).replace(/\n$/,"");return e||o&&o[1],s.jsx("code",{className:"px-1.5 py-1 rounded bg-white/20 text-[0.9em]",children:a})}),ChatMessageActions=({msg:t,allMessages:a,onRegenerate:n,isVisible:i})=>{const r="ai"===t.sender,[l,g]=e.useState(!1),[x,y]=e.useState(!1),{copied:j,copy:C}=useCopyToClipboard(),{copied:k,copy:w}=useCopyToClipboard(),{isSpeaking:S,speak:N,stop:f}=function(s){const[t,a]=e.useState(!1),[n,i]=e.useState([]);return e.useEffect(()=>{const handleVoicesChanged=()=>{i(speechSynthesis.getVoices())};return handleVoicesChanged(),speechSynthesis.addEventListener("voiceschanged",handleVoicesChanged),()=>{speechSynthesis.removeEventListener("voiceschanged",handleVoicesChanged),speechSynthesis.cancel()}},[]),{isSpeaking:t,speak:e.useCallback(()=>{if(!s||!n.length)return;const e=new SpeechSynthesisUtterance(s),t=n.find(e=>/en-US/i.test(e.lang)&&/google|microsoft/i.test(e.name))||n.find(e=>/en-US/i.test(e.lang));t&&(e.voice=t),e.pitch=1,e.rate=1.1,e.onstart=()=>a(!0),e.onend=()=>a(!1),e.onerror=()=>a(!1),speechSynthesis.speak(e)},[s,n]),stop:e.useCallback(()=>{speechSynthesis.cancel(),a(!1)},[])}}(t.text),v=e.useCallback(()=>{if(!a||!a.length)return;const e=a.map(e=>`${"ai"===e.sender?"AI":"User"}: ${e.text}`).join("\n\n");w(e)},[a,w]);return s.jsxs("div",{className:m("absolute -bottom-4 right-0 flex items-center gap-1 p-1 rounded-full bg-black/20 border border-white/10 opacity-0 transition-all duration-300","group-hover:opacity-100 group-hover:-bottom-5",i&&"opacity-100 -bottom-5"),children:[r&&s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>{g(!l),y(!1)},title:"Like",className:m("icon-action-btn",l&&"text-green-400"),children:s.jsx(p,{className:"w-4 h-4"})}),s.jsx("button",{onClick:()=>{y(!x),g(!1)},title:"Dislike",className:m("icon-action-btn",x&&"text-red-400"),children:s.jsx(d,{className:"w-4 h-4"})})]}),a&&a.length>1&&s.jsx("button",{onClick:v,title:k?"Copied All!":"Copy All Messages",className:m("icon-action-btn",k&&"text-green-400"),children:k?s.jsx(o,{className:"w-4 h-4"}):s.jsx(c,{className:"w-4 h-4 rotate-45"})}),s.jsx("button",{onClick:()=>C(t.text),title:j?"Copied!":"Copy Message",className:m("icon-action-btn",j&&"text-green-400"),children:j?s.jsx(o,{className:"w-4 h-4"}):s.jsx(c,{className:"w-4 h-4"})}),r&&n&&!S&&s.jsx("button",{onClick:n,title:"Regenerate",className:"icon-action-btn",children:s.jsx(h,{className:"w-4 h-4"})}),r&&s.jsx("button",{onClick:()=>{S?f():N()},title:S?"Stop":"Speak",className:m("icon-action-btn",S&&"text-blue-400"),children:S?s.jsx(b,{className:"w-4 h-4 animate-pulse"}):s.jsx(u,{className:"w-4 h-4"})})]})};function ChatMessageBubble({msg:o,onRegenerate:c,allMessages:r}){const l="ai"===o.sender,[p,d]=e.useState(!1);return s.jsxs(t.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},onClick:()=>d(e=>!e),className:m("group max-w-[80%] px-4 py-3 rounded-xl shadow-md backdrop-blur-md break-words whitespace-pre-wrap relative mb-4",l?"bg-white/10 text-white self-start":"bg-white/85 text-black font-semibold self-end",p&&"z-10"),children:[s.jsx("div",{className:m("prose prose-sm max-w-none prose-p:text-inherit prose-headings:text-inherit prose-strong:text-inherit",l?"prose-invert":""),children:s.jsx(a,{rehypePlugins:[i],remarkPlugins:[n],components:{code:g},children:o.text})}),s.jsx(ChatMessageActions,{msg:o,allMessages:r,onRegenerate:c,isVisible:p})]})}export{ChatMessageBubble as default};
