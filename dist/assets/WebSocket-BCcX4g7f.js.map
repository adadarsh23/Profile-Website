{"version":3,"file":"WebSocket-BCcX4g7f.js","sources":["../../src/components/WebSocketClient.jsx","../../src/WebSocket.jsx"],"sourcesContent":["// src/components/WebSocketClient.jsx\nimport { useEffect, useRef, useImperativeHandle, forwardRef } from 'react';\n\n/**\n * WebSocketClient v3.2 â€” Production-Grade (No UI)\n * Features:\n * âœ… Auto-reconnect with exponential backoff + jitter\n * âœ… Heartbeat ping/pong keepalive\n * âœ… JSON-safe send/receive\n * âœ… Graceful cleanup + manual close override\n * âœ… Safe logging and connection state\n * âœ… Exposes sendMessage(), reconnect(), close(), getStatus() via ref\n */\n\nconst WebSocketClient = forwardRef(\n  (\n    {\n      url = 'wss://echo.websocket.events',\n      onMessage,\n      onOpen,\n      onError,\n      onClose,\n      reconnect = true,\n      reconnectAttempts = 10,\n      heartbeatInterval = 30000, // 30s\n      debug = false,\n    },\n    ref\n  ) => {\n    const socketRef = useRef(null);\n    const reconnectCount = useRef(0);\n    const heartbeatRef = useRef(null);\n    const reconnectTimeout = useRef(null);\n    const manualClose = useRef(false);\n    const state = useRef('DISCONNECTED');\n\n    const log = (msg, type = 'info') => {\n      if (debug) console[type](`[WebSocketClient] ${msg}`);\n    };\n\n    const cleanup = () => {\n      stopHeartbeat();\n      clearTimeout(reconnectTimeout.current);\n      reconnectTimeout.current = null;\n\n      if (socketRef.current) {\n        try {\n          socketRef.current.onopen = null;\n          socketRef.current.onmessage = null;\n          socketRef.current.onerror = null;\n          socketRef.current.onclose = null;\n          if (socketRef.current.readyState === WebSocket.OPEN) {\n            socketRef.current.close(1000, 'Manual cleanup');\n          }\n        } catch (e) {\n          log(`Cleanup error: ${e.message}`, 'warn');\n        }\n        socketRef.current = null;\n      }\n      log('ðŸ§¹ Cleanup complete');\n    };\n\n    const startHeartbeat = () => {\n      stopHeartbeat();\n      heartbeatRef.current = setInterval(() => {\n        if (socketRef.current?.readyState === WebSocket.OPEN) {\n          socketRef.current.send(\n            JSON.stringify({ type: 'ping', ts: Date.now() })\n          );\n          log('ðŸ’“ Ping sent', 'debug');\n        }\n      }, heartbeatInterval);\n    };\n\n    const stopHeartbeat = () => {\n      if (heartbeatRef.current) {\n        clearInterval(heartbeatRef.current);\n        heartbeatRef.current = null;\n      }\n    };\n\n    const connect = () => {\n      if (manualClose.current) {\n        log('Manual close active â€” skipping reconnect', 'warn');\n        return;\n      }\n\n      cleanup();\n      log(`ðŸ”Œ Connecting â†’ ${url}`);\n      state.current = 'CONNECTING';\n\n      let socket;\n      try {\n        socket = new WebSocket(url);\n      } catch (err) {\n        log(`WebSocket constructor failed: ${err.message}`, 'error');\n        return;\n      }\n\n      socketRef.current = socket;\n\n      socket.onopen = () => {\n        reconnectCount.current = 0;\n        state.current = 'CONNECTED';\n        log(`âœ… Connected â†’ ${url}`);\n        startHeartbeat();\n\n        if (typeof onOpen === 'function') onOpen();\n        sendMessage({ type: 'hello', msg: 'ðŸ‘‹ from WebSocketClient' });\n      };\n\n      socket.onmessage = (event) => {\n        let data = event.data;\n        try {\n          const parsed = JSON.parse(event.data);\n          if (parsed.type === 'pong') {\n            log('ðŸ’“ Pong received (alive)', 'debug');\n            return;\n          }\n          data = parsed;\n        } catch (_) {\n          /* non-JSON messages are fine */\n        }\n        log(`ðŸ“¨ Message received: ${JSON.stringify(data)}`, 'debug');\n        if (typeof onMessage === 'function') onMessage(data);\n      };\n\n      socket.onerror = (event) => {\n        let msg = 'Unknown WebSocket error';\n        if (event instanceof Event && event.target?.url)\n          msg = `Connection error to ${event.target.url}`;\n        log(`âŒ ${msg}`, 'error');\n        if (typeof onError === 'function') onError(event);\n      };\n\n      socket.onclose = (event) => {\n        state.current = 'DISCONNECTED';\n        stopHeartbeat();\n        log(`ðŸ”’ Closed (${event.code}) ${event.reason || 'No reason'}`, 'warn');\n        if (typeof onClose === 'function') onClose(event);\n\n        if (manualClose.current) {\n          log('ðŸ‘‹ Manual close detected â€” skipping reconnect');\n          return;\n        }\n\n        if (reconnect && reconnectCount.current < reconnectAttempts) {\n          const base = 2000;\n          const delay = Math.min(base * 2 ** reconnectCount.current, 30000);\n          const jitter = Math.floor(Math.random() * 500);\n          const totalDelay = delay + jitter;\n          log(`ðŸ” Reconnecting in ${(totalDelay / 1000).toFixed(1)}s...`);\n          reconnectTimeout.current = setTimeout(connect, totalDelay);\n          reconnectCount.current += 1;\n        } else {\n          log(\n            'ðŸ›‘ Max reconnect attempts reached or reconnect disabled',\n            'warn'\n          );\n        }\n      };\n    };\n\n    const sendMessage = (data) => {\n      if (\n        !socketRef.current ||\n        socketRef.current.readyState !== WebSocket.OPEN\n      ) {\n        log('âš ï¸ Cannot send â€” socket not open', 'warn');\n        return false;\n      }\n      const message =\n        typeof data === 'object' ? JSON.stringify(data) : String(data);\n      try {\n        socketRef.current.send(message);\n        log(`ðŸ“¤ Sent: ${message}`, 'debug');\n        return true;\n      } catch (e) {\n        log(`Send error: ${e.message}`, 'error');\n        return false;\n      }\n    };\n\n    const closeConnection = () => {\n      manualClose.current = true;\n      log('ðŸ›‘ Manual close requested');\n      cleanup();\n    };\n\n    const getStatus = () => state.current;\n\n    useImperativeHandle(ref, () => ({\n      sendMessage,\n      getStatus,\n      reconnect: connect,\n      close: closeConnection,\n    }));\n\n    useEffect(() => {\n      connect();\n      return () => cleanup();\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [url]);\n\n    return null;\n  }\n);\n\nexport default WebSocketClient;\n","import { useRef } from 'react';\nimport WebSocketClient from './components/WebSocketClient';\n\nexport default function WebSocket() {\n  const wsRef = useRef();\n\n  // const handleMessage = (msg) => console.log(\"ðŸ“© Message from server:\", msg);\n  // const handleOpen = () => console.log(\"ðŸš€ Connected!\");\n  // const handleClose = () => console.log(\"ðŸ”Œ Connection closed.\");\n\n  // const sendTestMessage = () => {\n  //   wsRef.current?.sendMessage({ type: \"custom\", text: \"Hello Server!\" });\n  // };\n\n  return (\n    <>\n      <WebSocketClient\n        ref={wsRef}\n        url=\"wss://echo.websocket.events\"\n        // onMessage={handleMessage}\n        // onOpen={handleOpen}\n        // onClose={handleClose}\n        debug={true}\n      />\n\n      {/* Trigger send manually for testing */}\n      {/* <button onClick={sendTestMessage}>Send Test Message</button> */}\n    </>\n  );\n}\n"],"names":["WebSocketClient","forwardRef","url","onMessage","onOpen","onError","onClose","reconnect","reconnectAttempts","heartbeatInterval","debug","ref","socketRef","useRef","reconnectCount","heartbeatRef","reconnectTimeout","manualClose","state","log","msg","type","cleanup","stopHeartbeat","e","startHeartbeat","connect","socket","err","sendMessage","event","data","parsed","delay","jitter","totalDelay","message","closeConnection","getStatus","useImperativeHandle","useEffect","WebSocket","wsRef","jsx","Fragment"],"mappings":"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"}