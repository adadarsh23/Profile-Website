const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatInput-C6nCFo3M.js","assets/vendor-C8sBI81f.js","assets/utils-BtE0PGZ8.js","assets/ChatMessageBubble-B_als04u.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,m as a,b9 as s,ba as n,bb as i,bc as r,A as o,_ as l}from"./vendor-C8sBI81f.js";import{c}from"./utils-BtE0PGZ8.js";import{l as d}from"./index-Dq7C8MoF.js";function delay(e){return new Promise(t=>setTimeout(t,e))}const h="aiChatHistory";const u=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]);function MessageLoading(){return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[t.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),t.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),t.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const m=e.memo(({status:e})=>"idle"===e||"error"===e?null:t.jsx(a.div,{className:"flex items-center gap-3 px-4 py-3 rounded-xl max-w-[40%] bg-white/10 self-start",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,ease:"easeOut"},children:t.jsx(MessageLoading,{})})),w=e.lazy(()=>l(()=>import("./ChatInput-C6nCFo3M.js"),__vite__mapDeps([0,1,2]))),y=e.lazy(()=>l(()=>import("./ChatMessageBubble-B_als04u.js"),__vite__mapDeps([3,1,2])));function AIChatCard({className:l,onClose:f}){const p=[{sender:"ai",id:`ai-initial-${Date.now()}`,text:"ðŸ‘‹ Hey there! Iâ€™m your AD assistant. How can I help?"}],{messages:x,setMessages:b,clearSession:g}=function(t){const[a,s]=e.useState(()=>{if("undefined"!=typeof window)try{const e=sessionStorage.getItem(h);if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){sessionStorage.removeItem(h)}return[...t]});e.useEffect(()=>{try{sessionStorage.setItem(h,JSON.stringify(a))}catch(e){}},[a]);const n=e.useCallback(()=>{try{sessionStorage.removeItem(h),s([...t])}catch(e){}},[t]);return{messages:a,setMessages:s,clearSession:n}}(p),{updateMemory:v}=function(){const[t,a]=e.useState(null);return{memory:t,updateMemory:e.useCallback(e=>{if(0===e.length)return void a(null);const t=e.map(e=>e.text).join(" "),s=t.toLowerCase().match(/\b\w+\b/g)?.filter(e=>e.length>=4&&!u.has(e)).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),n=s?Object.entries(s).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e):[],i=t.length>250?`...${t.slice(-250)}`:t;a({summary:i,keywords:n})},[])}}(),[j,C]=e.useState(""),[N,S]=e.useState("idle"),k=e.useRef(null);e.useEffect(()=>{const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[]),e.useEffect(()=>{k.current&&k.current.scrollTo({top:k.current.scrollHeight,behavior:"smooth"})},[x,N]);const $=e.useCallback(async e=>{const t=(e||j).trim();if(!t||"idle"!==N)return;const a={sender:"user",text:t,id:`user-${Date.now()}`,timestamp:Date.now()};b(e=>[...e,a]),C(""),S("thinking");try{await new Promise(e=>setTimeout(e,500));const e=await async function(e){const t=e.map(e=>({role:"ai"===e.sender?"model":"user",content:e.text}));let a=0;for(;a<3;)try{const e=new AbortController,s=setTimeout(()=>e.abort(),15e3),n=await fetch("https://ai-assistant-server-colf.onrender.com/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t}),signal:e.signal});if(clearTimeout(s),!n.ok){if(429===n.status){a++,await delay(1500*a);continue}throw new Error(`Gemini request failed (${n.status})`)}const i=await n.json();return i.data?.candidates?.[0]?.content?.parts?.[0]?.text||"âš ï¸ No response from Gemini."}catch(s){if(a>=2)return"âš ï¸ Gemini is currently unavailable. Please try again later.";a++,await delay(1500*a)}return"âŒ Gemini API limit reached. Please try again later."}([...x,a]),t=function(e){if(!e)return"";let t=e.replace(/\r\n/g,"\n");return t=t.replace(/(\S)(```)/g,"$1\n$2"),t=t.replace(/(```)(\S)/g,"$1\n$2"),t=t.replace(/\n{3,}/g,"\n\n"),t.trim()}(e),s={sender:"ai",text:t,id:`ai-${Date.now()}`,timestamp:Date.now()};b(e=>[...e,s]),v([...x,a,s])}catch(s){const e={sender:"ai",text:"âš ï¸ Something went wrong. Please try again.",id:`err-${Date.now()}`,timestamp:Date.now()};b(t=>[...t,e]),S("error")}finally{S("idle")}},[j,N,x,b,v]),A=e.useCallback(()=>{b([]),setTimeout(g,300)},[b,g]),I=e.useCallback(()=>{if(!x.length)return;const e=new Date,t=`AI_Chat_${e.toISOString().replace(/[:.]/g,"-")}.txt`,a=x.map(e=>`[${(e=>e?new Date(e).toLocaleString():"N/A")(e.timestamp)}] ${"user"===e.sender?"ðŸ§‘ User":"ðŸ¤– AI"}:\n${e.text}`).join("\n--------------------------------------\n\n"),s=["===== AI Chat Export =====",`Date: ${e.toLocaleDateString()}`,`Time: ${e.toLocaleTimeString()}`,`Total Messages: ${x.length}`,"======================================",""].join("\n"),n=new Blob([s+a],{type:"text/plain"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=t,r.click(),URL.revokeObjectURL(i)},[x]),T=e.useCallback(async()=>{if(!x.length)return;const e=`AI Chat on ${(new Date).toLocaleDateString()}`,t=`===== ${e} =====\n\n${x.map(e=>`${"user"===e.sender?"ðŸ§‘ User":"ðŸ¤– AI"}:\n${e.text}`).join("\n\n--------------------------------------\n\n")}`;if(navigator.share)try{await navigator.share({title:e,text:t})}catch(a){I()}else I()},[x,I]),_={hidden:{y:-20,opacity:0},visible:{y:0,opacity:1}};return t.jsxs("div",{className:c("relative w-full h-full rounded-2xl overflow-hidden p-[2px]",l),children:[t.jsx(a.div,{className:"absolute inset-0 rounded-2xl border-2 border-white/20",animate:{rotate:[0,360]},transition:{duration:25,repeat:1/0,ease:"linear"}}),t.jsxs("div",{className:"relative flex flex-col w-full h-full rounded-xl border border-white/10 overflow-hidden bg-black/90 backdrop-blur-xl",children:[t.jsxs(a.div,{className:"flex justify-between items-center px-4 py-3 border-b border-white/10 z-10 flex-wrap gap-2",variants:{hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:.1,delayChildren:.2}}},initial:"hidden",animate:"visible",children:[t.jsx(a.div,{variants:_,animate:{scale:1.05},transition:{duration:2,repeatType:"reverse",ease:"easeInOut"},children:t.jsx("img",{src:d,alt:"Adarsh Logo",className:"w-8 h-8 rounded"})}),t.jsx(a.h2,{className:"text-lg font-semibold text-white",variants:_,children:"AD Assistant"}),t.jsxs(a.div,{className:"flex items-center gap-3",variants:_,children:[t.jsx(a.button,{onClick:T,className:"icon-btn",title:"Share or Export Chat",whileHover:{scale:1.1,y:-1},whileTap:{scale:.9},children:t.jsx(s,{className:"w-4 h-4"})}),t.jsx(a.button,{onClick:I,className:"icon-btn",title:"Export Chat",whileHover:{scale:1.1,y:-1},whileTap:{scale:.9},children:t.jsx(n,{className:"w-4 h-4"})}),t.jsx(a.button,{onClick:A,className:"icon-btn",title:"Clear Chat",whileHover:{scale:1.1,y:-1},whileTap:{scale:.9},children:t.jsx(i,{className:"w-4 h-4"})}),f&&t.jsx(a.button,{onClick:f,className:"icon-btn",title:"Close Chat",whileHover:{scale:1.1,y:-1},whileTap:{scale:.9},children:t.jsx(r,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{ref:k,className:"flex-1 px-4 py-3 overflow-y-auto space-y-3 text-sm flex flex-col relative z-10",children:[t.jsx(o,{initial:!1,children:x.map(a=>t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"w-full h-10"}),children:t.jsx(y,{msg:a,onRegenerate:()=>$(a.text)})},a.id))}),t.jsx(m,{status:N})]}),t.jsx(a.div,{variants:{hidden:{y:20,opacity:0},visible:{y:0,opacity:1,transition:{duration:.3,ease:"easeOut",delay:.4}}},initial:"hidden",animate:"visible",children:t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"p-3 border-t border-white/10 h-[53px]"}),children:t.jsx(w,{value:j,onChange:C,onSend:()=>$(),disabled:"idle"!==N||!j.trim()})})})]})]})}export{AIChatCard as default};
