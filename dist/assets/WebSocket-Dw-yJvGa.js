import{r as c,j as m}from"./vendor_react-dEWb8ZBQ.js";import"./vendor-BydJ7EqF.js";import"./vendor_react-dom-Bh-7mpZz.js";const T=c.forwardRef(({url:s="wss://echo.websocket.events",onMessage:S,onOpen:y,onError:C,onClose:k,reconnect:$=!0,reconnectAttempts:h=10,heartbeatInterval:E=3e4,debug:R=!1},O)=>{const n=c.useRef(null),a=c.useRef(0),l=c.useRef(null),f=c.useRef(null),d=c.useRef(!1),i=c.useRef("DISCONNECTED"),e=(r,t="info")=>{R&&console[t](`[WebSocketClient] ${r}`)},p=()=>{if(g(),clearTimeout(f.current),f.current=null,n.current){try{n.current.onopen=null,n.current.onmessage=null,n.current.onerror=null,n.current.onclose=null,n.current.readyState===WebSocket.OPEN&&n.current.close(1e3,"Manual cleanup")}catch(r){e(`Cleanup error: ${r.message}`,"warn")}n.current=null}e("ðŸ§¹ Cleanup complete")},W=()=>{g(),l.current=setInterval(()=>{n.current?.readyState===WebSocket.OPEN&&(n.current.send(JSON.stringify({type:"ping",ts:Date.now()})),e("ðŸ’“ Ping sent","debug"))},E)},g=()=>{l.current&&(clearInterval(l.current),l.current=null)},b=()=>{if(d.current){e("Manual close active â€” skipping reconnect","warn");return}p(),e(`ðŸ”Œ Connecting â†’ ${s}`),i.current="CONNECTING";let r;try{r=new WebSocket(s)}catch(t){e(`WebSocket constructor failed: ${t.message}`,"error");return}n.current=r,r.onopen=()=>{a.current=0,i.current="CONNECTED",e(`âœ… Connected â†’ ${s}`),W(),typeof y=="function"&&y(),N({type:"hello",msg:"ðŸ‘‹ from WebSocketClient"})},r.onmessage=t=>{let o=t.data;try{const u=JSON.parse(t.data);if(u.type==="pong"){e("ðŸ’“ Pong received (alive)","debug");return}o=u}catch{}e(`ðŸ“¨ Message received: ${JSON.stringify(o)}`,"debug"),typeof S=="function"&&S(o)},r.onerror=t=>{let o="Unknown WebSocket error";t instanceof Event&&t.target?.url&&(o=`Connection error to ${t.target.url}`),e(`âŒ ${o}`,"error"),typeof C=="function"&&C(t)},r.onclose=t=>{if(i.current="DISCONNECTED",g(),e(`ðŸ”’ Closed (${t.code}) ${t.reason||"No reason"}`,"warn"),typeof k=="function"&&k(t),d.current){e("ðŸ‘‹ Manual close detected â€” skipping reconnect");return}if($&&a.current<h){const u=Math.min(2e3*2**a.current,3e4),D=Math.floor(Math.random()*500),w=u+D;e(`ðŸ” Reconnecting in ${(w/1e3).toFixed(1)}s...`),f.current=setTimeout(b,w),a.current+=1}else e("ðŸ›‘ Max reconnect attempts reached or reconnect disabled","warn")}},N=r=>{if(!n.current||n.current.readyState!==WebSocket.OPEN)return e("âš ï¸ Cannot send â€” socket not open","warn"),!1;const t=typeof r=="object"?JSON.stringify(r):String(r);try{return n.current.send(t),e(`ðŸ“¤ Sent: ${t}`,"debug"),!0}catch(o){return e(`Send error: ${o.message}`,"error"),!1}},M=()=>{d.current=!0,e("ðŸ›‘ Manual close requested"),p()},x=()=>i.current;return c.useImperativeHandle(O,()=>({sendMessage:N,getStatus:x,reconnect:b,close:M})),c.useEffect(()=>(b(),()=>p()),[s]),null});function v(){const s=c.useRef();return m.jsx(m.Fragment,{children:m.jsx(T,{ref:s,url:"wss://echo.websocket.events",debug:!0})})}export{v as default};
