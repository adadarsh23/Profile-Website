!function(){function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}System.register(["./vendor_react-legacy-CKQfhyGe.js","./vendor-legacy-kKFF0Zoi.js"],function(e,n){"use strict";var t,r;return{setters:[function(e){t=e.r,r=e.j},null],execute:function(){e("default",function(){var e=t.useRef();return r.jsx(r.Fragment,{children:r.jsx(n,{ref:e,url:"wss://echo.websocket.events",debug:!0})})});var n=t.forwardRef(function(e,n){var r=e.url,o=void 0===r?"wss://echo.websocket.events":r,c=e.onMessage,u=e.onOpen,a=e.onError,s=e.onClose,f=e.reconnect,i=void 0===f||f,l=e.reconnectAttempts,y=void 0===l?10:l,d=e.heartbeatInterval,p=void 0===d?3e4:d,v=(e.debug,t.useRef(null)),g=t.useRef(0),S=t.useRef(null),m=t.useRef(null),b=t.useRef(!1),N=t.useRef("DISCONNECTED"),cleanup=function(){if(stopHeartbeat(),clearTimeout(m.current),m.current=null,v.current){try{v.current.onopen=null,v.current.onmessage=null,v.current.onerror=null,v.current.onclose=null,v.current.readyState===WebSocket.OPEN&&v.current.close(1e3,"Manual cleanup")}catch(e){"Cleanup error: ".concat(e.message)}v.current=null}},stopHeartbeat=function(){S.current&&(clearInterval(S.current),S.current=null)},_connect=function(){if(!b.current){var e;cleanup(),"üîå Connecting ‚Üí ".concat(o),N.current="CONNECTING";try{e=new WebSocket(o)}catch(n){return void"WebSocket constructor failed: ".concat(n.message)}v.current=e,e.onopen=function(){g.current=0,N.current="CONNECTED","‚úÖ Connected ‚Üí ".concat(o),stopHeartbeat(),S.current=setInterval(function(){var e;(null===(e=v.current)||void 0===e?void 0:e.readyState)===WebSocket.OPEN&&v.current.send(JSON.stringify({type:"ping",ts:Date.now()}))},p),"function"==typeof u&&u(),sendMessage({type:"hello",msg:"üëã from WebSocketClient"})},e.onmessage=function(e){var n=e.data;try{var t=JSON.parse(e.data);if("pong"===t.type)return;n=t}catch(r){}"üì® Message received: ".concat(JSON.stringify(n)),"function"==typeof c&&c(n)},e.onerror=function(e){var n,t="Unknown WebSocket error";e instanceof Event&&null!==(n=e.target)&&void 0!==n&&n.url&&(t="Connection error to ".concat(e.target.url)),"‚ùå ".concat(t),"function"==typeof a&&a(e)},e.onclose=function(e){if(N.current="DISCONNECTED",stopHeartbeat(),"üîí Closed (".concat(e.code,") ").concat(e.reason||"No reason"),"function"==typeof s&&s(e),!b.current&&i&&g.current<y){var n=Math.min(2e3*Math.pow(2,g.current),3e4)+Math.floor(500*Math.random());"üîÅ Reconnecting in ".concat((n/1e3).toFixed(1),"s..."),m.current=setTimeout(_connect,n),g.current+=1}}}},sendMessage=function(e){if(!v.current||v.current.readyState!==WebSocket.OPEN)return!1;var n="object"===_typeof(e)?JSON.stringify(e):String(e);try{return v.current.send(n),"üì§ Sent: ".concat(n),!0}catch(t){return"Send error: ".concat(t.message),!1}},closeConnection=function(){b.current=!0,cleanup()},getStatus=function(){return N.current};return t.useImperativeHandle(n,function(){return{sendMessage:sendMessage,getStatus:getStatus,reconnect:_connect,close:closeConnection}}),t.useEffect(function(){return _connect(),function(){return cleanup()}},[o]),null})}}})}();
