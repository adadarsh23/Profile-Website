import{r as e,j as r}from"./index-Bo3zL1WM.js";const t=e.forwardRef(({url:r="wss://echo.websocket.events",onMessage:t,onOpen:n,onError:c,onClose:o,reconnect:u=!0,reconnectAttempts:s=10,heartbeatInterval:a=3e4,debug:l=!1},f)=>{const i=e.useRef(null),g=e.useRef(0),p=e.useRef(null),d=e.useRef(null),y=e.useRef(!1),S=e.useRef("DISCONNECTED"),m=()=>{if(N(),clearTimeout(d.current),d.current=null,i.current){try{i.current.onopen=null,i.current.onmessage=null,i.current.onerror=null,i.current.onclose=null,i.current.readyState===WebSocket.OPEN&&i.current.close(1e3,"Manual cleanup")}catch(e){e.message}i.current=null}},N=()=>{p.current&&(clearInterval(p.current),p.current=null)},h=()=>{if(y.current)return;let e;m(),S.current="CONNECTING";try{e=new WebSocket(r)}catch(l){return void l.message}i.current=e,e.onopen=()=>{g.current=0,S.current="CONNECTED",N(),p.current=setInterval(()=>{i.current?.readyState===WebSocket.OPEN&&i.current.send(JSON.stringify({type:"ping",ts:Date.now()}))},a),"function"==typeof n&&n(),E({type:"hello",msg:"ðŸ‘‹ from WebSocketClient"})},e.onmessage=e=>{let r=e.data;try{const t=JSON.parse(e.data);if("pong"===t.type)return;r=t}catch(n){}JSON.stringify(r),"function"==typeof t&&t(r)},e.onerror=e=>{let r="Unknown WebSocket error";e instanceof Event&&e.target?.url&&(r=`Connection error to ${e.target.url}`),"function"==typeof c&&c(e)},e.onclose=e=>{if(S.current="DISCONNECTED",N(),e.code,e.reason,"function"==typeof o&&o(e),!y.current&&u&&g.current<s){const e=2e3,r=Math.min(e*2**g.current,3e4)+Math.floor(500*Math.random());(r/1e3).toFixed(1),d.current=setTimeout(h,r),g.current+=1}}},E=e=>{if(!i.current||i.current.readyState!==WebSocket.OPEN)return!1;const r="object"==typeof e?JSON.stringify(e):String(e);try{return i.current.send(r),!0}catch(t){return t.message,!1}},b=()=>{y.current=!0,m()},O=()=>S.current;return e.useImperativeHandle(f,()=>({sendMessage:E,getStatus:O,reconnect:h,close:b})),e.useEffect(()=>(h(),()=>m()),[r]),null});function n(){const n=e.useRef();return r.jsx(r.Fragment,{children:r.jsx(t,{ref:n,url:"https://echo.websocket.org/",debug:!0})})}export{n as default};
