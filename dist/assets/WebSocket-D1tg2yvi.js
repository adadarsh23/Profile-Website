import{r as e,j as r}from"./vendor-DEvyvm6K.js";const t=e.forwardRef(({url:r="wss://echo.websocket.events",onMessage:t,onOpen:n,onError:c,onClose:o,reconnect:u=!0,reconnectAttempts:s=10,heartbeatInterval:a=3e4,debug:l=!1},f)=>{const i=e.useRef(null),g=e.useRef(0),p=e.useRef(null),d=e.useRef(null),S=e.useRef(!1),y=e.useRef("DISCONNECTED"),cleanup=()=>{if(stopHeartbeat(),clearTimeout(d.current),d.current=null,i.current){try{i.current.onopen=null,i.current.onmessage=null,i.current.onerror=null,i.current.onclose=null,i.current.readyState===WebSocket.OPEN&&i.current.close(1e3,"Manual cleanup")}catch(e){e.message}i.current=null}},stopHeartbeat=()=>{p.current&&(clearInterval(p.current),p.current=null)},connect=()=>{if(S.current)return;let e;cleanup(),y.current="CONNECTING";try{e=new WebSocket(r)}catch(l){return void l.message}i.current=e,e.onopen=()=>{g.current=0,y.current="CONNECTED",stopHeartbeat(),p.current=setInterval(()=>{i.current?.readyState===WebSocket.OPEN&&i.current.send(JSON.stringify({type:"ping",ts:Date.now()}))},a),"function"==typeof n&&n(),sendMessage({type:"hello",msg:"ðŸ‘‹ from WebSocketClient"})},e.onmessage=e=>{let r=e.data;try{const t=JSON.parse(e.data);if("pong"===t.type)return;r=t}catch(n){}JSON.stringify(r),"function"==typeof t&&t(r)},e.onerror=e=>{let r="Unknown WebSocket error";e instanceof Event&&e.target?.url&&(r=`Connection error to ${e.target.url}`),"function"==typeof c&&c(e)},e.onclose=e=>{if(y.current="DISCONNECTED",stopHeartbeat(),e.code,e.reason,"function"==typeof o&&o(e),!S.current&&u&&g.current<s){const e=2e3,r=Math.min(e*2**g.current,3e4)+Math.floor(500*Math.random());(r/1e3).toFixed(1),d.current=setTimeout(connect,r),g.current+=1}}},sendMessage=e=>{if(!i.current||i.current.readyState!==WebSocket.OPEN)return!1;const r="object"==typeof e?JSON.stringify(e):String(e);try{return i.current.send(r),!0}catch(t){return t.message,!1}},closeConnection=()=>{S.current=!0,cleanup()},getStatus=()=>y.current;return e.useImperativeHandle(f,()=>({sendMessage:sendMessage,getStatus:getStatus,reconnect:connect,close:closeConnection})),e.useEffect(()=>(connect(),()=>cleanup()),[r]),null});function WebSocket$1(){const n=e.useRef();return r.jsx(r.Fragment,{children:r.jsx(t,{ref:n,url:"https://echo.websocket.org/",debug:!0})})}export{WebSocket$1 as default};
