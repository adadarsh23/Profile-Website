import{j as e,Y as D,r as i,Z as _,$ as O,a0 as P,a1 as I,a2 as $,a3 as U,X as G,a4 as F,a5 as H,a6 as Y,a7 as z,a8 as K,a9 as q,aa as B}from"./vendor_react-Ds5Dw94k.js";import{c as b}from"./utils-Dyalv6Xw.js";import{af as R,by as J,bz as V}from"./vendor-CthcAJlN.js";import"./vendor_react-dom-BnmT66wm.js";const W="https://ai-assistant-server-colf.onrender.com/api/gemini";function A(a){return new Promise(n=>setTimeout(n,a))}async function X(a){const n=a.map(t=>({role:t.sender==="ai"?"model":"user",content:t.text}));let r=0;const s=3;for(;r<s;)try{const t=new AbortController,c=setTimeout(()=>t.abort(),15e3),h=await fetch(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:n}),signal:t.signal});if(clearTimeout(c),!h.ok){if(h.status===429){r++,console.warn(`âš ï¸ Rate limit hit. Retrying... (${r}/${s})`),await A(1500*r);continue}throw new Error(`Gemini request failed (${h.status})`)}return(await h.json()).data?.candidates?.[0]?.content?.parts?.[0]?.text||"âš ï¸ No response from Gemini."}catch(t){if(r>=s-1)return console.error("âŒ Gemini Chat Error:",t),"âš ï¸ Gemini is currently unavailable. Please try again later.";r++,await A(1500*r)}return"âŒ Gemini API limit reached. Please try again later."}function Z({value:a,onChange:n,onSend:r,disabled:s}){return e.jsxs("div",{className:"flex items-center gap-2 p-3 border-t border-white/10 relative z-10",children:[e.jsx("input",{className:"flex-1 px-3 py-2 text-sm bg-black/50 rounded-lg border border-white/10 text-white focus:outline-none focus:ring-1 focus:ring-white/50",placeholder:"Type a message...",value:a,onChange:t=>n(t.target.value),onKeyDown:t=>t.key==="Enter"&&r()}),e.jsx("button",{onClick:r,disabled:s,className:b("p-2 rounded-lg transition-colors",s?"bg-black/10 cursor-not-allowed":"bg-white/10 hover:bg-white/20"),children:e.jsx(D,{className:"w-4 h-4 text-white"})})]})}const Q=i.memo(({inline:a,className:n,children:r})=>{const[s,t]=i.useState(!1),c=/language-(\w+)/.exec(n||""),h=String(r).replace(/\n$/,""),p=()=>{navigator.clipboard.writeText(h),t(!0),setTimeout(()=>t(!1),2e3)};return!a&&c?e.jsxs("div",{className:"relative my-2",children:[e.jsx("button",{onClick:p,className:"absolute top-2 right-2 p-1.5 rounded-md bg-black/30 text-white/70 hover:bg-black/50 hover:text-white transition-all",title:"Copy code",children:s?e.jsx($,{className:"w-4 h-4 text-green-400"}):e.jsx(I,{className:"w-4 h-4"})}),e.jsx(H,{language:c[1],PreTag:"div",showLineNumbers:!1,wrapLongLines:!0,style:Y,customStyle:{borderRadius:"0.5rem",padding:"1rem",fontSize:"0.875rem"},children:h})]}):e.jsx("code",{className:"px-1.5 py-1 rounded bg-white/20 text-[0.9em]",children:r})});function ee({msg:a,onRegenerate:n,allMessages:r}){const s=a.sender==="ai",[t,c]=i.useState(!1),[h,p]=i.useState(!1),[l,d]=i.useState(!1),[f,w]=i.useState(!1),N=()=>{navigator.clipboard.writeText(a.text),d(!0),setTimeout(()=>d(!1),1500)},j=()=>{if(!r||!r.length)return;const o=r.map(u=>`${u.sender==="ai"?"AI":"User"}: ${u.text}`).join(`

`);navigator.clipboard.writeText(o),d(!0),setTimeout(()=>d(!1),1500)},k=()=>{if(f){speechSynthesis.cancel(),w(!1);return}if(!a.text)return;const o=new SpeechSynthesisUtterance(a.text),u=speechSynthesis.getVoices(),x=u.find(m=>/en-US/i.test(m.lang)&&/google|microsoft/i.test(m.name))||u.find(m=>/en-US/i.test(m.lang));x&&(o.voice=x),o.pitch=1,o.rate=1.1,o.onstart=()=>w(!0),o.onend=()=>w(!1),o.onerror=()=>w(!1),speechSynthesis.speak(o)};return e.jsxs(R.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},className:b("group max-w-[80%] px-4 py-3 rounded-xl shadow-md backdrop-blur-md break-words whitespace-pre-wrap relative mb-4",s?"bg-white/10 text-white self-start":"bg-white/85 text-black font-semibold self-end"),children:[e.jsx(_,{rehypePlugins:[V],remarkPlugins:[J],className:b("prose prose-sm max-w-none prose-p:text-inherit prose-headings:text-inherit prose-strong:text-inherit",s?"prose-invert":""),components:{code:Q},children:a.text}),e.jsxs("div",{className:"absolute -bottom-4 right-0 flex items-center gap-1 p-1 rounded-full bg-black/20 border border-white/10 opacity-0 group-hover:opacity-100 group-hover:-bottom-5 transition-all duration-300",children:[s&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{c(!t),p(!1)},title:"Like",className:b("icon-action-btn",t&&"text-green-400"),children:e.jsx(O,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>{p(!h),c(!1)},title:"Dislike",className:b("icon-action-btn",h&&"text-red-400"),children:e.jsx(P,{className:"w-4 h-4"})})]}),r&&r.length>1&&e.jsx("button",{onClick:j,title:"Copy All Messages",className:"icon-action-btn",children:e.jsx(I,{className:"w-4 h-4 rotate-45"})}),e.jsx("button",{onClick:N,title:l?"Copied!":"Copy Message",className:b("icon-action-btn",l&&"text-green-400"),children:l?e.jsx($,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"})}),s&&n&&!f&&e.jsx("button",{onClick:n,title:"Regenerate",className:"icon-action-btn",children:e.jsx(U,{className:"w-4 h-4"})}),e.jsx("button",{onClick:k,title:f?"Stop":"Speak",className:b("icon-action-btn",f&&"text-blue-400"),children:f?e.jsx(G,{className:"w-4 h-4 animate-pulse"}):e.jsx(F,{className:"w-4 h-4"})})]})]})}const C="aiChatHistory";function te(a){const[n,r]=i.useState(()=>{if(typeof window<"u")try{const t=sessionStorage.getItem(C);if(t){const c=JSON.parse(t);if(Array.isArray(c))return c}}catch(t){console.error("Failed to parse chat history from sessionStorage:",t),sessionStorage.removeItem(C)}return[...a]});i.useEffect(()=>{try{sessionStorage.setItem(C,JSON.stringify(n))}catch(t){console.error("Failed to save chat history to sessionStorage:",t)}},[n]);const s=i.useCallback(()=>{try{sessionStorage.removeItem(C),r([...a])}catch(t){console.error("Failed to clear chat session from sessionStorage:",t)}},[a]);return{messages:n,setMessages:r,clearSession:s}}const se=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]),ne=4,ae=8,E=250;function re(){const[a,n]=i.useState(null),r=i.useCallback(s=>{if(s.length===0){n(null);return}const t=s.map(l=>l.text).join(" "),c=t.toLowerCase().match(/\b\w+\b/g)?.filter(l=>l.length>=ne&&!se.has(l)).reduce((l,d)=>(l[d]=(l[d]||0)+1,l),{}),h=c?Object.entries(c).sort(([,l],[,d])=>d-l).slice(0,ae).map(([l])=>l):[],p=t.length>E?`...${t.slice(-E)}`:t;n({summary:p,keywords:h})},[]);return{memory:a,updateMemory:r}}function oe(a){if(!a)return"";let n=a.replace(/\r\n/g,`
`);return n=n.replace(/(\S)(```)/g,`$1
$2`),n=n.replace(/(```)(\S)/g,`$1
$2`),n=n.replace(/\n{3,}/g,`

`),n.trim()}function ie(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[e.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"white",children:e.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"white",children:e.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),e.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"white",children:e.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const le=i.memo(({status:a})=>a==="idle"||a==="error"?null:e.jsx(R.div,{className:"flex items-center gap-3 px-4 py-3 rounded-xl max-w-[40%] bg-white/10 self-start",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,ease:"easeOut"},children:e.jsx(ie,{})})),ce=500,he="âš ï¸ Something went wrong. Please try again.";function xe({className:a,onClose:n}){const r=[{sender:"ai",text:"ðŸ‘‹ Hey there! Iâ€™m your AI assistant. How can I help?"}],{messages:s,setMessages:t,clearSession:c}=te(r),{updateMemory:h}=re(),[p,l]=i.useState(""),[d,f]=i.useState("idle"),w=i.useRef(null);i.useEffect(()=>{const o=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=o}},[]),i.useEffect(()=>{w.current&&w.current.scrollTo({top:w.current.scrollHeight,behavior:"smooth"})},[s,d]);const N=i.useCallback(async o=>{const u=(o||p).trim();if(!u||d!=="idle")return;const x={sender:"user",text:u,timestamp:Date.now()};t(m=>[...m,x]),l(""),f("thinking");try{await new Promise(S=>setTimeout(S,ce));const m=await X([...s,x]),y={sender:"ai",text:oe(m),timestamp:Date.now()};t(S=>[...S,y]),h([...s,x,y])}catch(m){console.error("Chat Error:",m);const g={sender:"ai",text:he,timestamp:Date.now()};t(y=>[...y,g]),f("error")}finally{f("idle")}},[p,d,s,t,h]),j=i.useCallback(()=>{if(!s.length)return;const o=new Date,u=`AI_Chat_${o.toISOString().replace(/[:.]/g,"-")}.txt`,x=v=>v?new Date(v).toLocaleString():"N/A",m=s.map(v=>{const M=x(v.timestamp),L=v.sender==="user"?"ðŸ§‘ User":"ðŸ¤– AI";return`[${M}] ${L}:
${v.text}`}).join(`
--------------------------------------

`),g=["===== AI Chat Export =====",`Date: ${o.toLocaleDateString()}`,`Time: ${o.toLocaleTimeString()}`,`Total Messages: ${s.length}`,"======================================",""].join(`
`),y=new Blob([g+m],{type:"text/plain"}),S=URL.createObjectURL(y),T=document.createElement("a");T.href=S,T.download=u,T.click(),URL.revokeObjectURL(S)},[s]),k=i.useCallback(async()=>{if(!s.length)return;const u=`AI Chat on ${new Date().toLocaleDateString()}`,x=s.map(g=>`${g.sender==="user"?"ðŸ§‘ User":"ðŸ¤– AI"}:
${g.text}`).join(`

--------------------------------------

`),m=`===== ${u} =====

${x}`;if(navigator.share)try{await navigator.share({title:u,text:m})}catch{j()}else j()},[s,j]);return e.jsxs("div",{className:b("relative w-full h-full rounded-2xl overflow-hidden p-[2px]",a),children:[e.jsx(R.div,{className:"absolute inset-0 rounded-2xl border-2 border-white/20",animate:{rotate:[0,360]},transition:{duration:25,repeat:1/0,ease:"linear"}}),e.jsxs("div",{className:"relative flex flex-col w-full h-full rounded-xl border border-white/10 overflow-hidden bg-black/90 backdrop-blur-xl",children:[e.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-white/10 z-10 flex-wrap gap-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-white",children:"AI Assistant"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:k,className:"icon-btn",title:"Share or Export Chat",children:e.jsx(z,{className:"w-4 h-4"})}),e.jsx("button",{onClick:j,className:"icon-btn",title:"Export Chat",children:e.jsx(K,{className:"w-4 h-4"})}),e.jsx("button",{onClick:c,className:"icon-btn",title:"Clear Chat",children:e.jsx(q,{className:"w-4 h-4"})}),n&&e.jsx("button",{onClick:n,className:"icon-btn",title:"Close Chat",children:e.jsx(B,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{ref:w,className:"flex-1 px-4 py-3 overflow-y-auto space-y-3 text-sm flex flex-col relative z-10",children:[s.map((o,u)=>e.jsx(ee,{msg:o,onRegenerate:()=>N(o.text)},u)),e.jsx(le,{status:d})]}),e.jsx(Z,{value:p,onChange:l,onSend:()=>N(),disabled:d!=="idle"||!p.trim()})]})]})}export{xe as default};
//# sourceMappingURL=AIChatCard-CNXREBUy.js.map
