import{a as p,j as u}from"./vendor_react-RnE43CiF.js";import"./vendor_react-dom-BwtVtmH1.js";import"./vendor-CewzeS4l.js";const h={IDLE:"idle",INITIALIZING:"initializing",RUNNING:"running",SUCCESS:"success",ERROR:"error",CANCELLED:"cancelled"},r={ERROR:"error",WARN:"warn",INFO:"info",DEBUG:"debug"},ee={autoReload:!1,silent:!0,preserveKeys:["auth","token","user","theme","session"],runDelay:1e3,debug:!1,manual:!1,ttlHours:24,progressUI:!1,statusIndicator:!0,retries:3,retryDelayMS:500,taskTimeoutMS:2e4,enableHealthCheck:!0,enableAnalytics:!1,gracefulDegradation:!0};class te{constructor(t=!1,e=!1){this.silent=t,this.debug=e,this.logs=[],this.maxLogs=1e3}log(t,e=r.INFO,s={}){const a={timestamp:new Date().toISOString(),level:e,message:t,meta:s};this.logs.push(a),this.logs.length>this.maxLogs&&this.logs.shift(),!(this.silent&&e!==r.ERROR)&&e===r.DEBUG&&this.debug}getLogs(){return[...this.logs]}exportLogs(){return JSON.stringify(this.logs,null,2)}}class re{constructor(t=3,e=500){this.maxRetries=t,this.baseDelay=e}async execute(t,e="Task"){let s;for(let a=0;a<=this.maxRetries;a++)try{return await t()}catch(o){if(s=o,a<this.maxRetries){const i=this.baseDelay*Math.pow(2,a);await this.sleep(i)}}throw new Error("".concat(e," failed after ").concat(this.maxRetries+1," attempts: ").concat(s.message))}sleep(t){return new Promise(e=>setTimeout(e,t))}}class I{static race(t,e,s="Task"){return Promise.race([t,new Promise((a,o)=>setTimeout(()=>o(new Error("".concat(s," timeout after ").concat(e,"ms"))),e))])}}class se{constructor(t,e=[]){this.logger=t,this.preserveKeys=e}shouldPreserve(t){return this.preserveKeys.some(e=>t.toLowerCase().includes(e.toLowerCase()))}clearWebStorage(t,e){try{const s=Object.keys(t),a=[],o=[];return s.forEach(i=>{if(this.shouldPreserve(i))a.push(i);else try{t.removeItem(i),o.push(i)}catch(g){this.logger.log("Failed to remove ".concat(e," key: ").concat(i),r.WARN,{error:g.message})}}),this.logger.log("".concat(e,": removed ").concat(o.length,", preserved ").concat(a.length),r.INFO),{success:!0,removed:o.length,preserved:a.length,keys:{removed:o,preserved:a}}}catch(s){return this.logger.log("".concat(e," cleanup failed"),r.ERROR,{error:s.message}),{success:!1,error:s.message}}}clearCookies(){try{const t=document.cookie.split(";").filter(Boolean);let e=0,s=0;return t.forEach(a=>{const o=a.split("=")[0].trim();if(this.shouldPreserve(o))s++;else try{document.cookie="".concat(o,"=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;"),document.cookie="".concat(o,"=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/;domain=").concat(window.location.hostname),e++}catch(i){this.logger.log("Failed to delete cookie: ".concat(o),r.WARN)}}),this.logger.log("Cookies: deleted ".concat(e,", preserved ").concat(s),r.INFO),{success:!0,deleted:e,preserved:s}}catch(t){return this.logger.log("Cookie cleanup failed",r.ERROR,{error:t.message}),{success:!1,error:t.message}}}async clearCacheStorage(t,e){try{if(!("caches"in window))return this.logger.log("CacheStorage API not supported",r.WARN),{success:!0,deleted:0,skipped:!0};const s=await I.race(caches.keys(),e,"CacheStorage.keys()"),a=s.filter(m=>!this.shouldPreserve(m)),o=s.length-a.length,i=await Promise.allSettled(a.map(m=>t.execute(()=>I.race(caches.delete(m),e,"Delete cache: ".concat(m)),"CacheStorage.delete(".concat(m,")")))),g=i.filter(m=>m.status==="fulfilled").length,c=i.filter(m=>m.status==="rejected").length;return this.logger.log("CacheStorage: deleted ".concat(g,", preserved ").concat(o,", failed ").concat(c),r.INFO),{success:!0,deleted:g,preserved:o,failed:c}}catch(s){return this.logger.log("CacheStorage cleanup failed",r.ERROR,{error:s.message}),{success:!1,error:s.message}}}async clearIndexedDB(t){try{if(!("indexedDB"in window))return this.logger.log("IndexedDB API not supported",r.WARN),{success:!0,deleted:0,skipped:!0};let e=[];if(typeof indexedDB.databases=="function")try{e=await I.race(indexedDB.databases(),t,"IndexedDB.databases()")||[]}catch(c){return this.logger.log("IndexedDB.databases() not available, skipping",r.WARN),{success:!0,deleted:0,skipped:!0}}else return this.logger.log("IndexedDB.databases() not supported in this browser",r.WARN),{success:!0,deleted:0,skipped:!0};const s=e.filter(c=>c.name&&!this.shouldPreserve(c.name)),a=e.length-s.length,o=await Promise.allSettled(s.map(c=>new Promise((m,A)=>{const v=indexedDB.deleteDatabase(c.name);v.onsuccess=()=>m(c.name),v.onerror=()=>A(new Error("Failed to delete ".concat(c.name))),v.onblocked=()=>this.logger.log("IndexedDB delete blocked: ".concat(c.name),r.WARN)}))),i=o.filter(c=>c.status==="fulfilled").length,g=o.filter(c=>c.status==="rejected").length;return this.logger.log("IndexedDB: deleted ".concat(i,", preserved ").concat(a,", failed ").concat(g),r.INFO),{success:!0,deleted:i,preserved:a,failed:g}}catch(e){return this.logger.log("IndexedDB cleanup failed",r.ERROR,{error:e.message}),{success:!1,error:e.message}}}async unregisterServiceWorkers(t,e){try{if(!("serviceWorker"in navigator))return this.logger.log("Service Workers not supported",r.WARN),{success:!0,unregistered:0,skipped:!0};const s=await I.race(navigator.serviceWorker.getRegistrations(),e,"ServiceWorker.getRegistrations()"),a=await Promise.allSettled(s.map(g=>t.execute(()=>I.race(g.unregister(),e,"SW.unregister()"),"ServiceWorker.unregister()"))),o=a.filter(g=>g.status==="fulfilled").length,i=a.filter(g=>g.status==="rejected").length;return this.logger.log("Service Workers: unregistered ".concat(o,", failed ").concat(i),r.INFO),{success:!0,unregistered:o,failed:i}}catch(s){return this.logger.log("Service Worker cleanup failed",r.ERROR,{error:s.message}),{success:!1,error:s.message}}}}function ae(S){const t=p.useMemo(()=>({...ee,...S}),[S]),{autoReload:e,silent:s,preserveKeys:a,runDelay:o,debug:i,manual:g,ttlHours:c,progressUI:m,statusIndicator:A,retries:v,retryDelayMS:P,taskTimeoutMS:C,enableHealthCheck:F,enableAnalytics:U,gracefulDegradation:M,onComplete:N,onError:E,onProgress:D}=t,[x,O]=p.useState(h.IDLE),[q,Y]=p.useState(0),[V,Z]=p.useState(!0),[k,_]=p.useState(!1),[H,X]=p.useState(null),L=p.useRef(!1),W=p.useRef(null),j=p.useRef(null),$=p.useRef(!1);W.current||(W.current=new te(s,i));const d=W.current,b=p.useCallback(n=>{Y(w=>{const l=Math.min(100,Math.max(0,w+n));return D==null||D(l),l})},[D]),B=p.useCallback(()=>{const n={timestamp:new Date().toISOString(),browserAPIs:{localStorage:"localStorage"in window,sessionStorage:"sessionStorage"in window,indexedDB:"indexedDB"in window,cacheStorage:"caches"in window,serviceWorker:"serviceWorker"in navigator,cookies:!!document.cookie},lastCleanup:localStorage.getItem("__cleanup_last_run__"),status:"healthy"};return X(n),d.log("Health check completed",r.INFO,n),n},[d]),T=p.useCallback(async(n=!1)=>{var z,G,J;if(L.current){d.log("Cleanup already in progress",r.WARN);return}if(!n){const f=Number(localStorage.getItem("__cleanup_last_run__")||0),y=(Date.now()-f)/(1e3*60*60);if(y<c){d.log("Cleanup not needed (".concat(y.toFixed(1),"h < ").concat(c,"h)"),r.INFO);return}}L.current=!0,$.current=!1,O(h.INITIALIZING),b(5);const w=performance.now(),l={startedAt:new Date().toISOString(),forced:n,config:{ttlHours:c,preserveKeys:a,retries:v,taskTimeoutMS:C},results:{}};try{d.log("Starting cleanup process",r.INFO),O(h.RUNNING),b(10);const f=new se(d,a),y=new re(v,P);if($.current)throw new Error("Cleanup cancelled by user");const Q=[f.clearCacheStorage(y,C),f.clearIndexedDB(C),f.unregisterServiceWorkers(y,C)],R=await Promise.allSettled(Q);if(l.results.cacheStorage=R[0].value||{error:(z=R[0].reason)==null?void 0:z.message},l.results.indexedDB=R[1].value||{error:(G=R[1].reason)==null?void 0:G.message},l.results.serviceWorkers=R[2].value||{error:(J=R[2].reason)==null?void 0:J.message},b(50),$.current)throw new Error("Cleanup cancelled by user");l.results.localStorage=f.clearWebStorage(localStorage,"LocalStorage"),b(20),l.results.sessionStorage=f.clearWebStorage(sessionStorage,"SessionStorage"),b(15),l.results.cookies=f.clearCookies(),b(5);const K=Math.round(performance.now()-w);l.completedAt=new Date().toISOString(),l.durationMS=K,l.status="success",localStorage.setItem("__cleanup_last_run__",Date.now().toString()),localStorage.setItem("__cleanup_last_report__",JSON.stringify(l)),d.log("Cleanup completed in ".concat(K,"ms"),r.INFO,l),O(h.SUCCESS),b(100),N==null||N(l),U&&window.dispatchEvent(new CustomEvent("cache-cleanup-complete",{detail:l})),e&&(d.log("Auto-reload in 2 seconds",r.INFO),setTimeout(()=>window.location.reload(),2e3)),setTimeout(()=>Z(!1),15e3)}catch(f){const y=Math.round(performance.now()-w);if(l.completedAt=new Date().toISOString(),l.durationMS=y,l.status="error",l.error=f.message,d.log("Cleanup failed: ".concat(f.message),r.ERROR,l),O(h.ERROR),E==null||E(f,l),localStorage.setItem("__cleanup_last_error__",JSON.stringify(l)),!M)throw f}finally{L.current=!1}},[d,c,a,v,P,C,b,e,U,M,N,E]);return p.useEffect(()=>{if(d.log("CacheCleaner initialized",r.INFO,t),window.cacheCleaner={trigger:()=>T(!0),cancel:()=>{$.current=!0,d.log("Cleanup cancellation requested",r.WARN)},getHealth:B,getLogs:()=>d.getLogs(),exportLogs:()=>d.exportLogs(),getLastReport:()=>JSON.parse(localStorage.getItem("__cleanup_last_report__")||"null")},F&&B(),!g){const n=setTimeout(()=>T(!1),o);return()=>clearTimeout(n)}},[t,T,d,g,o,B,F]),p.useEffect(()=>{if(k){const n=setTimeout(()=>_(!1),1e4),w=l=>{j.current&&!j.current.contains(l.target)&&_(!1)};return document.addEventListener("mousedown",w),()=>{clearTimeout(n),document.removeEventListener("mousedown",w)}}},[k]),p.useEffect(()=>(document.body.style.overflow=k?"hidden":"auto",()=>document.body.style.overflow="auto"),[k]),!V||typeof window>"u"?null:u.jsxs(u.Fragment,{children:[A&&u.jsxs("button",{onClick:()=>i&&_(n=>!n),"aria-label":"Cache cleaner status: ".concat(x),style:{position:"fixed",bottom:"clamp(10px, 2vw, 20px)",left:"clamp(10px, 2vw, 20px)",display:"flex",alignItems:"center",gap:"clamp(6px, 1.5vw, 10px)",padding:"clamp(6px, 1.5vw, 8px) clamp(10px, 3vw, 14px)",borderRadius:"20px",backgroundColor:"rgba(0, 0, 0, 0.7)",backdropFilter:"blur(10px)",border:"1px solid rgba(255, 255, 255, 0.1)",cursor:i?"pointer":"default",zIndex:48,transition:"all 0.3s ease",userSelect:"none"},onMouseEnter:n=>{i&&(n.currentTarget.style.transform="translateY(-2px)")},onMouseLeave:n=>{n.currentTarget.style.transform="translateY(0)"},children:[u.jsx("div",{style:{width:"clamp(10px, 2vw, 12px)",height:"clamp(10px, 2vw, 12px)",borderRadius:"50%",backgroundColor:x===h.RUNNING?"#3b82f6":x===h.SUCCESS?"#22c55e":x===h.ERROR?"#ef4444":"#6b7280",boxShadow:"0 0 8px ".concat(x===h.RUNNING?"#3b82f6":x===h.SUCCESS?"#22c55e":x===h.ERROR?"#ef4444":"transparent"),animation:x===h.RUNNING?"pulse 2s infinite":"none"}}),u.jsx("span",{style:{color:"#fff",fontSize:"clamp(11px, 2vw, 13px)",fontWeight:600,letterSpacing:"0.3px"},children:x===h.RUNNING?"Cleaning ".concat(q,"%"):x===h.SUCCESS?"✓ Clean":x===h.ERROR?"✗ Error":"Ready"})]}),i&&k&&u.jsxs("div",{ref:j,role:"dialog","aria-label":"Debug logs",style:{position:"fixed",bottom:"clamp(60px, 10vh, 80px)",left:"clamp(10px, 2vw, 20px)",width:"clamp(260px, 80vw, 400px)",maxHeight:"min(70vh, 400px)",backgroundColor:"#1a1a1a",border:"1px solid #333",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)",zIndex:49,display:"flex",flexDirection:"column",fontFamily:"monospace",overflow:"hidden",pointerEvents:"auto"},children:[u.jsxs("div",{style:{padding:"12px 16px",borderBottom:"1px solid #333",display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:"#0a0a0a",flexShrink:0},children:[u.jsx("span",{style:{color:"#fff",fontSize:"14px",fontWeight:600},children:"Debug Logs"}),u.jsx("button",{onClick:()=>_(!1),style:{background:"none",border:"none",color:"#888",cursor:"pointer",fontSize:"18px"},"aria-label":"Close debug panel",children:"×"})]}),u.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",fontSize:"clamp(10px, 2vw, 12px)",lineHeight:1.6,scrollbarWidth:"thin",scrollbarColor:"#444 #1a1a1a"},children:[H&&u.jsxs("div",{style:{marginBottom:"16px",paddingBottom:"16px",borderBottom:"1px solid #444"},children:[u.jsx("div",{style:{color:"#fff",fontSize:"13px",fontWeight:600,marginBottom:"8px"},children:"Health Status"}),u.jsx("pre",{style:{backgroundColor:"#2a2a2a",padding:"10px",borderRadius:"8px",overflowX:"auto",color:"#eee",fontSize:"clamp(9px, 1.8vw, 11px)",lineHeight:1.4,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:JSON.stringify(H,null,2)})]}),d.getLogs().length===0?u.jsx("div",{style:{color:"#666",textAlign:"center",padding:"20px"},children:"No logs yet"}):d.getLogs().map((n,w)=>u.jsxs("div",{style:{marginBottom:"8px",paddingBottom:"8px",borderBottom:"1px solid #222"},children:[u.jsx("div",{style:{color:"#666",fontSize:"10px"},children:new Date(n.timestamp).toLocaleTimeString()}),u.jsx("div",{style:{color:n.level===r.ERROR?"#ef4444":n.level===r.WARN?"#f59e0b":n.level===r.INFO?"#3b82f6":"#8b5cf6"},children:n.message})]},w))]})]}),u.jsx("style",{children:'\n      @keyframes pulse {\n        0%, 100% { opacity: 1; }\n        50% { opacity: 0.5; }\n      }\n\n      @media (max-width: 480px) {\n        /* Status Indicator on very small screens */\n        button[aria-label^="Cache cleaner status"] {\n          bottom: 10px;\n          left: 10px;\n          padding: 8px; /* Make it a square button */\n          min-width: 40px; /* Ensure it\'s clickable */\n          justify-content: center;\n        }\n        button[aria-label^="Cache cleaner status"] span { /* Hide text */\n          display: none;\n        }\n        button[aria-label^="Cache cleaner status"] div { /* Adjust dot size */\n          width: 10px;\n          height: 10px;\n        }\n\n        /* Debug Panel on very small screens */\n        div[aria-label="Debug logs"] {\n          bottom: 60px;\n          left: 10px;\n          right: 10px; /* Make it span almost full width */\n          width: auto; /* Override clamp width */\n          max-height: 60vh; /* Allow more vertical space */\n        }\n        div[aria-label="Debug logs"] .debug-panel-header span {\n          font-size: 13px; /* Slightly smaller header font */\n        }\n      }\n    '})]})}function ie(){return u.jsx("div",{children:u.jsx(ae,{autoReload:!1,silent:!1,debug:!0,progressUI:!0,statusIndicator:!0,ttlHours:12,manual:!1,preserveKeys:["auth","token","user","theme","session","visitor","statsig","logrocket","sentry","ga","framer","settings","config","state","redux","recoil"],retries:3,taskTimeoutMS:2e4,enableHealthCheck:!0,enableAnalytics:!1,gracefulDegradation:!0,onComplete:S=>{},onError:(S,t)=>{console.error("❌ Cleanup failed:",S)},onProgress:S=>{}})})}export{ie as default};
