import{r as e,j as t,m as s,X as a,be as n,bf as i,bg as o,bh as r,bi as l,bj as c,bk as d,bl as m,bm as h,bn as x,bo as p,bp as u,aO as g,_ as b}from"./vendor-BkT4tQa2.js";import{c as j}from"./utils-BWkryRgp.js";function useCopyToClipboard(t=2e3){const[s,a]=e.useState(!1);return{copied:s,copy:e.useCallback(e=>{navigator.clipboard.writeText(e).then(()=>{a(!0),setTimeout(()=>{a(!1)},t)})},[t])}}const w=e.memo(({code:s})=>{const[a,n]=e.useState(""),[i,o]=e.useState("");return e.useEffect(()=>{b(()=>import("./vendor-BkT4tQa2.js").then(e=>e.bq),[]).then(async e=>{e.default.initialize({startOnLoad:!1,theme:"dark"});try{const{svg:t}=await e.default.render(`mermaid-graph-${Math.random().toString(36).substring(2,9)}`,s);n(t),o("")}catch(t){o("Failed to render Mermaid diagram.")}})},[s]),i?t.jsx("pre",{className:"text-red-400",children:i}):a?t.jsx("div",{dangerouslySetInnerHTML:{__html:a}}):t.jsx("div",{className:"p-4 text-center",children:"Rendering graph..."})}),f=e.memo(({inline:e,className:s,children:a})=>{const{copied:n,copy:i}=useCopyToClipboard(),o=/language-(\w+)/.exec(s||""),r=String(a).replace(/\n$/,""),handleCopyCode=()=>i(r);return o&&"mermaid"===o[1]?t.jsx(w,{code:r}):e?t.jsx("code",{className:"px-1.5 py-1 rounded bg-white/20 text-[0.9em]",children:a}):t.jsxs("div",{className:"relative my-2",children:[t.jsx("button",{onClick:handleCopyCode,className:"absolute top-2 right-2 p-1.5 rounded-md bg-black/30 text-white/70 hover:bg-black/50 hover:text-white transition-all",title:"Copy code",children:n?t.jsx(l,{className:"w-4 h-4 text-green-400"}):t.jsx(c,{className:"w-4 h-4"})}),t.jsx(d,{language:o?o[1]:"text",PreTag:"div",showLineNumbers:!1,wrapLongLines:!0,style:m,customStyle:{fontFamily:"ui-monospace, monospace",borderRadius:"0.5rem",padding:"1rem",fontSize:"0.875rem",overflowX:"auto"},children:r})]})}),ChatMessageActions=({msg:s,allMessages:n,onRegenerate:i,isVisible:o,onEdit:r})=>{const d="ai"===s.sender,[m,b]=e.useState(!1),[w,f]=e.useState(!1),{copied:y,copy:N}=useCopyToClipboard(),{copied:k,copy:v}=useCopyToClipboard(),{isSpeaking:C,speak:S,stop:E}=function(t){const[s,a]=e.useState(!1),[n,i]=e.useState([]);return e.useEffect(()=>{const handleVoicesChanged=()=>{i(speechSynthesis.getVoices())};return handleVoicesChanged(),speechSynthesis.addEventListener("voiceschanged",handleVoicesChanged),()=>{speechSynthesis.removeEventListener("voiceschanged",handleVoicesChanged),speechSynthesis.cancel()}},[]),{isSpeaking:s,speak:e.useCallback(()=>{if(!t||!n.length)return;const e=new SpeechSynthesisUtterance(t),s=n.find(e=>/en-US/i.test(e.lang)&&/google|microsoft/i.test(e.name))||n.find(e=>/en-US/i.test(e.lang));s&&(e.voice=s),e.pitch=1,e.rate=1.1,e.onstart=()=>a(!0),e.onend=()=>a(!1),e.onerror=()=>a(!1),speechSynthesis.speak(e)},[t,n]),stop:e.useCallback(()=>{speechSynthesis.cancel(),a(!1)},[])}}(s.text),_=e.useCallback(()=>{if(!n||!n.length)return;const e=n.map(e=>`${"ai"===e.sender?"AI":"User"}: ${e.text}`).join("\n\n");v(e)},[n,v]);return t.jsxs("div",{className:j("absolute -bottom-4 right-0 flex items-center gap-1 p-1 rounded-full bg-black/20 border border-white/10 opacity-0 transition-all duration-300","group-hover:opacity-100 group-hover:-bottom-5",o&&"opacity-100 -bottom-5"),children:[!d&&t.jsx("button",{onClick:r,title:"Edit",className:"icon-action-btn","aria-label":"Edit message",children:t.jsx(h,{className:"w-4 h-4"})}),d&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{b(!m),f(!1)},title:"Like",className:j("icon-action-btn",m&&"text-green-400"),children:t.jsx(x,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{f(!w),b(!1)},title:"Dislike",className:j("icon-action-btn",w&&"text-red-400"),children:t.jsx(p,{className:"w-4 h-4"})})]}),n&&n.length>1&&t.jsx("button",{onClick:_,title:k?"Copied All!":"Copy All Messages",className:j("icon-action-btn",k&&"text-green-400"),children:k?t.jsx(l,{className:"w-4 h-4"}):t.jsx(c,{className:"w-4 h-4 rotate-45"})}),t.jsx("button",{onClick:()=>N(s.text),title:y?"Copied!":"Copy Message",className:j("icon-action-btn",y&&"text-green-400"),children:y?t.jsx(l,{className:"w-4 h-4"}):t.jsx(c,{className:"w-4 h-4"})}),d&&i&&!C&&t.jsx("button",{onClick:i,title:"Regenerate",className:"icon-action-btn",children:t.jsx(u,{className:"w-4 h-4"})}),d&&t.jsx("button",{onClick:()=>{C?E():S()},title:C?"Stop":"Speak",className:j("icon-action-btn",C&&"text-blue-400"),children:C?t.jsx(a,{className:"w-4 h-4 animate-pulse"}):t.jsx(g,{className:"w-4 h-4"})})]})},y=e.memo(function({msg:l,onRegenerate:c,allMessages:d,onEdit:m}){const h="ai"===l.sender,[x,p]=e.useState(!1),[u,g]=e.useState(!1),[b,w]=e.useState(l.text);return t.jsxs(s.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},onClick:()=>p(e=>!e),className:j("group max-w-[80%] px-4 py-3 rounded-xl shadow-md backdrop-blur-md break-words whitespace-pre-wrap relative mb-4",h?"bg-white/10 text-white self-start":"bg-white/85 text-black font-semibold self-end",x&&"z-10"),children:[u?t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("textarea",{value:b,onChange:e=>w(e.target.value),className:"w-full p-2 text-sm bg-white/10 rounded-lg border border-black/90 text-black focus:outline-none focus:ring-1 focus:ring-white/50",rows:Math.max(3,b.split("\n").length),autoFocus:!0}),t.jsxs("div",{className:"flex justify-start gap-2",children:[t.jsx("button",{onClick:()=>g(!1),className:"text-xs text-gray-400 hover:text-white",children:t.jsx(a,{className:"w-6 h-6"})}),t.jsx("button",{onClick:()=>{b.trim()!==l.text&&m(b.trim()),g(!1)},className:"flex items-center gap-1 text-xs text-green-400 hover:text-green-300",children:t.jsx(n,{className:"w-6 h-6"})})]})]}):t.jsx("div",{className:j("prose prose-sm max-w-none prose-p:text-inherit prose-headings:text-inherit prose-strong:text-inherit",h?"prose-invert":""),children:t.jsx(i,{rehypePlugins:[r],remarkPlugins:[o],components:{code:e=>t.jsx(f,{...e}),a:({node:e,...s})=>h?t.jsx("a",{...s,className:"text-blue-400 hover:text-blue-300 underline",target:"_blank",rel:"noopener noreferrer"}):t.jsx("a",{...s,target:"_blank",rel:"noopener noreferrer"})},children:l.text})}),t.jsx(ChatMessageActions,{msg:l,allMessages:d,onRegenerate:c,isVisible:x,onEdit:()=>g(!0)})]})});export{y as default};
