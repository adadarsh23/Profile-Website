const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatInput-DUoGWANC.js","assets/vendor-DxPgcqOE.js","assets/utils-UTJGMw8W.js","assets/ChatMessageBubble-DckebtAM.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,m as s,b8 as a,b9 as n,ba as r,bb as i,_ as o}from"./vendor-DxPgcqOE.js";import{c as l}from"./utils-UTJGMw8W.js";import{l as c}from"./index-DXdCKAnv.js";function delay(e){return new Promise(t=>setTimeout(t,e))}const h="aiChatHistory";const d=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]);function MessageLoading(){return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[t.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),t.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),t.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const u=e.memo(({status:e})=>"idle"===e||"error"===e?null:t.jsx(s.div,{className:"flex items-center gap-3 px-4 py-3 rounded-xl max-w-[40%] bg-white/10 self-start",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,ease:"easeOut"},children:t.jsx(MessageLoading,{})})),m=e.lazy(()=>o(()=>import("./ChatInput-DUoGWANC.js"),__vite__mapDeps([0,1,2]))),f=e.lazy(()=>o(()=>import("./ChatMessageBubble-DckebtAM.js"),__vite__mapDeps([3,1,2])));function AIChatCard({className:o,onClose:w}){const{messages:x,setMessages:g,clearSession:p}=function(t){const[s,a]=e.useState(()=>{if("undefined"!=typeof window)try{const e=sessionStorage.getItem(h);if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){sessionStorage.removeItem(h)}return[...t]});e.useEffect(()=>{try{sessionStorage.setItem(h,JSON.stringify(s))}catch(e){}},[s]);const n=e.useCallback(()=>{try{sessionStorage.removeItem(h),a([...t])}catch(e){}},[t]);return{messages:s,setMessages:a,clearSession:n}}([{sender:"ai",text:"ðŸ‘‹ Hey there! Iâ€™m your AD assistant. How can I help?"}]),{updateMemory:y}=function(){const[t,s]=e.useState(null);return{memory:t,updateMemory:e.useCallback(e=>{if(0===e.length)return void s(null);const t=e.map(e=>e.text).join(" "),a=t.toLowerCase().match(/\b\w+\b/g)?.filter(e=>e.length>=4&&!d.has(e)).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),n=a?Object.entries(a).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e):[],r=t.length>250?`...${t.slice(-250)}`:t;s({summary:r,keywords:n})},[])}}(),[b,j]=e.useState(""),[v,N]=e.useState("idle"),S=e.useRef(null);e.useEffect(()=>{const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[]),e.useEffect(()=>{S.current&&S.current.scrollTo({top:S.current.scrollHeight,behavior:"smooth"})},[x,v]);const C=e.useCallback(async e=>{const t=(e||b).trim();if(!t||"idle"!==v)return;const s={sender:"user",text:t,timestamp:Date.now()};g(e=>[...e,s]),j(""),N("thinking");try{await new Promise(e=>setTimeout(e,500));const e=await async function(e){const t=e.map(e=>({role:"ai"===e.sender?"model":"user",content:e.text}));let s=0;for(;s<3;)try{const e=new AbortController,a=setTimeout(()=>e.abort(),15e3),n=await fetch("https://ai-assistant-server-colf.onrender.com/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t}),signal:e.signal});if(clearTimeout(a),!n.ok){if(429===n.status){s++,await delay(1500*s);continue}throw new Error(`Gemini request failed (${n.status})`)}const r=await n.json();return r.data?.candidates?.[0]?.content?.parts?.[0]?.text||"âš ï¸ No response from Gemini."}catch(a){if(s>=2)return"âš ï¸ Gemini is currently unavailable. Please try again later.";s++,await delay(1500*s)}return"âŒ Gemini API limit reached. Please try again later."}([...x,s]),t=function(e){if(!e)return"";let t=e.replace(/\r\n/g,"\n");return t=t.replace(/(\S)(```)/g,"$1\n$2"),t=t.replace(/(```)(\S)/g,"$1\n$2"),t=t.replace(/\n{3,}/g,"\n\n"),t.trim()}(e),a={sender:"ai",text:t,timestamp:Date.now()};g(e=>[...e,a]),y([...x,s,a])}catch(a){const e={sender:"ai",text:"âš ï¸ Something went wrong. Please try again.",timestamp:Date.now()};g(t=>[...t,e]),N("error")}finally{N("idle")}},[b,v,x,g,y]),k=e.useCallback(()=>{if(!x.length)return;const e=new Date,t=`AI_Chat_${e.toISOString().replace(/[:.]/g,"-")}.txt`,s=x.map(e=>`[${(e=>e?new Date(e).toLocaleString():"N/A")(e.timestamp)}] ${"user"===e.sender?"ðŸ§‘ User":"ðŸ¤– AI"}:\n${e.text}`).join("\n--------------------------------------\n\n"),a=["===== AI Chat Export =====",`Date: ${e.toLocaleDateString()}`,`Time: ${e.toLocaleTimeString()}`,`Total Messages: ${x.length}`,"======================================",""].join("\n"),n=new Blob([a+s],{type:"text/plain"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=t,i.click(),URL.revokeObjectURL(r)},[x]),I=e.useCallback(async()=>{if(!x.length)return;const e=`AI Chat on ${(new Date).toLocaleDateString()}`,t=`===== ${e} =====\n\n${x.map(e=>`${"user"===e.sender?"ðŸ§‘ User":"ðŸ¤– AI"}:\n${e.text}`).join("\n\n--------------------------------------\n\n")}`;if(navigator.share)try{await navigator.share({title:e,text:t})}catch(s){k()}else k()},[x,k]);return t.jsxs("div",{className:l("relative w-full h-full rounded-2xl overflow-hidden p-[2px]",o),children:[t.jsx(s.div,{className:"absolute inset-0 rounded-2xl border-2 border-white/20",animate:{rotate:[0,360]},transition:{duration:25,repeat:1/0,ease:"linear"}}),t.jsxs("div",{className:"relative flex flex-col w-full h-full rounded-xl border border-white/10 overflow-hidden bg-black/90 backdrop-blur-xl",children:[t.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-white/10 z-10 flex-wrap gap-2",children:[t.jsx("img",{src:c,alt:"Adarsh Logo",className:"w-8 h-8 rounded"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"AD Assistant"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:I,className:"icon-btn",title:"Share or Export Chat",children:t.jsx(a,{className:"w-4 h-4"})}),t.jsx("button",{onClick:k,className:"icon-btn",title:"Export Chat",children:t.jsx(n,{className:"w-4 h-4"})}),t.jsx("button",{onClick:p,className:"icon-btn",title:"Clear Chat",children:t.jsx(r,{className:"w-4 h-4"})}),w&&t.jsx("button",{onClick:w,className:"icon-btn",title:"Close Chat",children:t.jsx(i,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{ref:S,className:"flex-1 px-4 py-3 overflow-y-auto space-y-3 text-sm flex flex-col relative z-10",children:[x.map((s,a)=>t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"w-full h-10"}),children:t.jsx(f,{msg:s,onRegenerate:()=>C(s.text)})},a)),t.jsx(u,{status:v})]}),t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"p-3 border-t border-white/10 h-[53px]"}),children:t.jsx(m,{value:b,onChange:j,onSend:()=>C(),disabled:"idle"!==v||!b.trim()})})]})]})}export{AIChatCard as default};
