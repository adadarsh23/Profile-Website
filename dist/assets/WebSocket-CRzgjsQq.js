import{a as c,j as m}from"./vendor_react-RnE43CiF.js";import"./vendor_react-dom-BwtVtmH1.js";import"./vendor-CewzeS4l.js";const T=c.forwardRef(({url:u="wss://echo.websocket.events",onMessage:S,onOpen:y,onError:C,onClose:k,reconnect:$=!0,reconnectAttempts:h=10,heartbeatInterval:E=3e4,debug:R=!1},O)=>{const r=c.useRef(null),a=c.useRef(0),l=c.useRef(null),f=c.useRef(null),d=c.useRef(!1),i=c.useRef("DISCONNECTED"),e=(n,t="info")=>{R&&console[t]("[WebSocketClient] ".concat(n))},p=()=>{if(g(),clearTimeout(f.current),f.current=null,r.current){try{r.current.onopen=null,r.current.onmessage=null,r.current.onerror=null,r.current.onclose=null,r.current.readyState===WebSocket.OPEN&&r.current.close(1e3,"Manual cleanup")}catch(n){e("Cleanup error: ".concat(n.message),"warn")}r.current=null}e("🧹 Cleanup complete")},W=()=>{g(),l.current=setInterval(()=>{var n;((n=r.current)==null?void 0:n.readyState)===WebSocket.OPEN&&(r.current.send(JSON.stringify({type:"ping",ts:Date.now()})),e("💓 Ping sent","debug"))},E)},g=()=>{l.current&&(clearInterval(l.current),l.current=null)},b=()=>{if(d.current){e("Manual close active — skipping reconnect","warn");return}p(),e("🔌 Connecting → ".concat(u)),i.current="CONNECTING";let n;try{n=new WebSocket(u)}catch(t){e("WebSocket constructor failed: ".concat(t.message),"error");return}r.current=n,n.onopen=()=>{a.current=0,i.current="CONNECTED",e("✅ Connected → ".concat(u)),W(),typeof y=="function"&&y(),N({type:"hello",msg:"👋 from WebSocketClient"})},n.onmessage=t=>{let o=t.data;try{const s=JSON.parse(t.data);if(s.type==="pong"){e("💓 Pong received (alive)","debug");return}o=s}catch(s){}e("📨 Message received: ".concat(JSON.stringify(o)),"debug"),typeof S=="function"&&S(o)},n.onerror=t=>{var s;let o="Unknown WebSocket error";t instanceof Event&&((s=t.target)!=null&&s.url)&&(o="Connection error to ".concat(t.target.url)),e("❌ ".concat(o),"error"),typeof C=="function"&&C(t)},n.onclose=t=>{if(i.current="DISCONNECTED",g(),e("🔒 Closed (".concat(t.code,") ").concat(t.reason||"No reason"),"warn"),typeof k=="function"&&k(t),d.current){e("👋 Manual close detected — skipping reconnect");return}if($&&a.current<h){const s=Math.min(2e3*2**a.current,3e4),D=Math.floor(Math.random()*500),w=s+D;e("🔁 Reconnecting in ".concat((w/1e3).toFixed(1),"s...")),f.current=setTimeout(b,w),a.current+=1}else e("🛑 Max reconnect attempts reached or reconnect disabled","warn")}},N=n=>{if(!r.current||r.current.readyState!==WebSocket.OPEN)return e("⚠️ Cannot send — socket not open","warn"),!1;const t=typeof n=="object"?JSON.stringify(n):String(n);try{return r.current.send(t),e("📤 Sent: ".concat(t),"debug"),!0}catch(o){return e("Send error: ".concat(o.message),"error"),!1}},M=()=>{d.current=!0,e("🛑 Manual close requested"),p()},x=()=>i.current;return c.useImperativeHandle(O,()=>({sendMessage:N,getStatus:x,reconnect:b,close:M})),c.useEffect(()=>(b(),()=>p()),[u]),null});function v(){const u=c.useRef();return m.jsx(m.Fragment,{children:m.jsx(T,{ref:u,url:"wss://echo.websocket.events",debug:!0})})}export{v as default};
