import{r as e,j as t,be as s,bf as a,bg as n,bh as i,bi as o,bj as r,X as l,aO as c,bk as d,bl as x,bm as h,bn as u,bo as m,bp as p,m as b}from"./vendor-CAHoof4P.js";import{c as g}from"./utils-Dgk8Wh8d.js";function useCopyToClipboard(t=2e3){const[s,a]=e.useState(!1);return{copied:s,copy:e.useCallback(e=>{navigator.clipboard.writeText(e).then(()=>{a(!0),setTimeout(()=>{a(!1)},t)})},[t])}}const ChatMessageActions=({msg:d,allMessages:x,onRegenerate:h,isVisible:u,onEdit:m})=>{const p="ai"===d.sender,[b,j]=e.useState(!1),[f,w]=e.useState(!1),{copied:k,copy:y}=useCopyToClipboard(),{copied:N,copy:C}=useCopyToClipboard(),{isSpeaking:v,speak:S,stop:E}=function(t){const[s,a]=e.useState(!1),[n,i]=e.useState(!1),[o,r]=e.useState([]);return e.useEffect(()=>{const handleVoicesChanged=()=>{r(speechSynthesis.getVoices())};return handleVoicesChanged(),speechSynthesis.addEventListener("voiceschanged",handleVoicesChanged),()=>{speechSynthesis.removeEventListener("voiceschanged",handleVoicesChanged),speechSynthesis.cancel()}},[]),{isSpeaking:s,isPaused:n,speak:e.useCallback(e=>{if(!t||!o.length)return;speechSynthesis.cancel(),i(!1);const s=new SpeechSynthesisUtterance(t),n=e?.voice||o.find(e=>/en-US/i.test(e.lang)&&/google|microsoft/i.test(e.name))||o.find(e=>/en-US/i.test(e.lang));n&&(s.voice=n),s.pitch=e?.pitch??1,s.rate=e?.rate??1,s.onstart=()=>{a(!0),i(!1)},s.onend=()=>{a(!1),i(!1)},s.onerror=()=>{a(!1),i(!1)},s.onpause=()=>i(!0),s.onresume=()=>i(!1),speechSynthesis.speak(s)},[t,o]),pause:e.useCallback(()=>{speechSynthesis.pause()},[]),resume:e.useCallback(()=>{speechSynthesis.resume()},[]),stop:e.useCallback(()=>{speechSynthesis.cancel(),a(!1),i(!1)},[]),voices:o}}(d.text),T=e.useCallback(()=>{if(!x||!x.length)return;const e=x.map(e=>`${"ai"===e.sender?"AI":"User"}: ${e.text}`).join("\n\n");C(e)},[x,C]);return t.jsxs("div",{className:g("absolute -bottom-4 right-0 flex items-center gap-1 p-1 rounded-full bg-black/20 border border-white/10 opacity-0 transition-all duration-300","group-hover:opacity-100 group-hover:-bottom-5",u&&"opacity-100 -bottom-5"),children:[!p&&t.jsx("button",{onClick:m,title:"Edit",className:"icon-action-btn","aria-label":"Edit message",children:t.jsx(s,{className:"w-4 h-4"})}),p&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{j(!b),w(!1)},title:"Like",className:g("icon-action-btn",b&&"text-green-400"),children:t.jsx(a,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>{w(!f),j(!1)},title:"Dislike",className:g("icon-action-btn",f&&"text-red-400"),children:t.jsx(n,{className:"w-4 h-4"})})]}),x&&x.length>1&&t.jsx("button",{onClick:T,title:N?"Copied All!":"Copy All Messages",className:g("icon-action-btn",N&&"text-green-400"),children:N?t.jsx(i,{className:"w-4 h-4"}):t.jsx(o,{className:"w-4 h-4 rotate-45"})}),t.jsx("button",{onClick:()=>y(d.text),title:k?"Copied!":"Copy Message",className:g("icon-action-btn",k&&"text-green-400"),children:k?t.jsx(i,{className:"w-4 h-4"}):t.jsx(o,{className:"w-4 h-4"})}),p&&h&&!v&&t.jsx("button",{onClick:h,title:"Regenerate",className:"icon-action-btn",children:t.jsx(r,{className:"w-4 h-4"})}),p&&t.jsx("button",{onClick:()=>{v?E():S()},title:v?"Stop":"Speak",className:g("icon-action-btn",v&&"text-blue-400"),children:v?t.jsx(l,{className:"w-4 h-4 animate-pulse"}):t.jsx(c,{className:"w-4 h-4"})})]})};function EditMessageForm({initialText:s,onSave:a,onCancel:n}){const[i,o]=e.useState(s);return t.jsxs("div",{className:"flex flex-col gap-2",onClick:e=>e.stopPropagation(),children:[t.jsx("textarea",{value:i,onChange:e=>o(e.target.value),className:"w-full p-2 text-sm bg-white/10 rounded-lg border border-black/90 text-black focus:outline-none focus:ring-1 focus:ring-white/50",rows:Math.max(3,i.split("\n").length),autoFocus:!0}),t.jsxs("div",{className:"flex justify-start gap-2",children:[t.jsx("button",{onClick:n,className:"text-xs text-gray-400 hover:text-white",children:t.jsx(l,{className:"w-6 h-6"})}),t.jsx("button",{onClick:()=>{a(i)},className:"flex items-center gap-1 text-xs text-green-400 hover:text-green-300",children:t.jsx(d,{className:"w-6 h-6"})})]})]})}function CodeBlock({inline:s,className:a,children:n,...r}){const[l,c]=e.useState(!1),d=/language-(\w+)/.exec(a||""),u=d?d[1]:"",m=String(n).replace(/\n$/,"");e.useEffect(()=>{if(l){const e=setTimeout(()=>c(!1),2e3);return()=>clearTimeout(e)}},[l]);return s?t.jsx("code",{className:"bg-black/20 text-inherit px-1 py-0.5 rounded text-sm font-mono",...r,children:n}):t.jsxs("div",{className:"relative my-4 rounded-lg overflow-hidden border border-white/10 bg-[#282c34]",children:[t.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-white/5 border-b border-white/10",children:[t.jsx("span",{className:"text-xs text-gray-400 font-mono lowercase",children:u||"text"}),t.jsx("button",{onClick:()=>{m&&(navigator.clipboard.writeText(m),c(!0))},className:"text-gray-400 hover:text-white transition-colors",title:"Copy code",children:l?t.jsx(i,{className:"w-3.5 h-3.5"}):t.jsx(o,{className:"w-3.5 h-3.5"})})]}),t.jsx("div",{className:"overflow-x-auto",children:t.jsx(x,{...r,style:h,language:u,PreTag:"div",customStyle:{margin:0,padding:"1rem",background:"transparent",fontSize:"0.875rem"},children:m})})]})}function MessageContent({text:e,isAI:s}){return t.jsx("div",{className:g("prose prose-sm max-w-none prose-p:text-inherit prose-headings:text-inherit prose-strong:text-inherit",s?"prose-invert":""),children:t.jsx(u,{rehypePlugins:[p],remarkPlugins:[m],components:{code:e=>t.jsx(CodeBlock,{...e}),a:({node:e,...a})=>s?t.jsx("a",{...a,className:"text-blue-400 hover:text-blue-300 underline",target:"_blank",rel:"noopener noreferrer"}):t.jsx("a",{...a,target:"_blank",rel:"noopener noreferrer"})},children:e})})}const j=e.memo(function({msg:s,onRegenerate:a,allMessages:n,onEdit:i}){const o="ai"===s.sender,[r,l]=e.useState(!1),[c,d]=e.useState(!1);return t.jsxs(b.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},onClick:()=>l(e=>!e),className:g("group max-w-[80%] px-4 py-3 rounded-xl shadow-md backdrop-blur-md break-words whitespace-pre-wrap relative mb-4",o?"bg-white/10 text-white self-start":"bg-white/85 text-black font-semibold self-end",r&&"z-10"),children:[c?t.jsx(EditMessageForm,{initialText:s.text,onSave:e=>{e.trim()!==s.text&&i(e.trim()),d(!1)},onCancel:()=>d(!1)}):t.jsx(MessageContent,{text:s.text,isAI:o}),t.jsx(ChatMessageActions,{msg:s,allMessages:n,onRegenerate:a,isVisible:r,onEdit:()=>d(!0)})]})});export{j as default};
