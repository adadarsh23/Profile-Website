const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ChatInput-CJ7LULMn.js","assets/index-Diha6eJ9.js","assets/index-CC7cSDEm.css","assets/utils-Gh3qGYQG.js","assets/createLucideIcon-naNngOWo.js","assets/ChatMessageBubble-CbaY1wIv.js","assets/proxy-DXRlS3FN.js","assets/x-C6yd6-8r.js","assets/extends-DPdBf6DS.js"])))=>i.map(i=>d[i]);
import{r as e,j as t,l as s,_ as a}from"./index-Diha6eJ9.js";import{c as n}from"./utils-Gh3qGYQG.js";import{m as r}from"./proxy-DXRlS3FN.js";import{c as i}from"./createLucideIcon-naNngOWo.js";const o=i("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),l=i("panel-right-close",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m8 9 3 3-3 3",key:"12hl5m"}]]),c=i("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),h=i("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);function d(e){return new Promise(t=>setTimeout(t,e))}const u="aiChatHistory";const m=new Set(["i","me","my","myself","we","our","ours","ourselves","you","your","yours","yourself","yourselves","he","him","his","himself","she","her","hers","herself","it","its","itself","they","them","their","theirs","themselves","what","which","who","whom","this","that","these","those","am","is","are","was","were","be","been","being","have","has","had","having","do","does","did","doing","a","an","the","and","but","if","or","because","as","until","while","of","at","by","for","with","about","against","between","into","through","during","before","after","above","below","to","from","up","down","in","out","on","off","over","under","again","further","then","once","here","there","when","where","why","how","all","any","both","each","few","more","most","other","some","such","no","nor","not","only","own","same","so","than","too","very","s","t","can","will","just","don","should","now"]);function y(){return t.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",className:"text-foreground",children:[t.jsx("circle",{cx:"4",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{id:"spinner_qFRN",begin:"0;spinner_OcgL.end+0.25s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),t.jsx("circle",{cx:"12",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{begin:"spinner_qFRN.begin+0.1s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})}),t.jsx("circle",{cx:"20",cy:"12",r:"2",fill:"white",children:t.jsx("animate",{id:"spinner_OcgL",begin:"spinner_qFRN.begin+0.2s",attributeName:"cy",calcMode:"spline",dur:"0.6s",values:"12;6;12",keySplines:".33,.66,.66,1;.33,0,.66,.33"})})]})}const f=e.memo(({status:e})=>"idle"===e||"error"===e?null:t.jsx(r.div,{className:"flex items-center gap-3 px-4 py-3 rounded-xl max-w-[40%] bg-white/10 self-start",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},transition:{duration:.3,ease:"easeOut"},children:t.jsx(y,{})})),x=e.lazy(()=>a(()=>import("./ChatInput-CJ7LULMn.js"),__vite__mapDeps([0,1,2,3,4]))),p=e.lazy(()=>a(()=>import("./ChatMessageBubble-CbaY1wIv.js"),__vite__mapDeps([5,1,2,3,6,4,7,8])));function w({className:a,onClose:i}){const{messages:y,setMessages:w,clearSession:g}=function(t){const[s,a]=e.useState(()=>{if("undefined"!=typeof window)try{const e=sessionStorage.getItem(u);if(e){const t=JSON.parse(e);if(Array.isArray(t))return t}}catch(e){sessionStorage.removeItem(u)}return[...t]});e.useEffect(()=>{try{sessionStorage.setItem(u,JSON.stringify(s))}catch(e){}},[s]);const n=e.useCallback(()=>{try{sessionStorage.removeItem(u),a([...t])}catch(e){}},[t]);return{messages:s,setMessages:a,clearSession:n}}([{sender:"ai",text:"ðŸ‘‹ Hey there! Iâ€™m your AD assistant. How can I help?"}]),{updateMemory:b}=function(){const[t,s]=e.useState(null);return{memory:t,updateMemory:e.useCallback(e=>{if(0===e.length)return void s(null);const t=e.map(e=>e.text).join(" "),a=t.toLowerCase().match(/\b\w+\b/g)?.filter(e=>e.length>=4&&!m.has(e)).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{}),n=a?Object.entries(a).sort(([,e],[,t])=>t-e).slice(0,8).map(([e])=>e):[],r=t.length>250?`...${t.slice(-250)}`:t;s({summary:r,keywords:n})},[])}}(),[j,v]=e.useState(""),[k,N]=e.useState("idle"),S=e.useRef(null);e.useEffect(()=>{const e=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=e}},[]),e.useEffect(()=>{S.current&&S.current.scrollTo({top:S.current.scrollHeight,behavior:"smooth"})},[y,k]);const C=e.useCallback(async e=>{const t=(e||j).trim();if(!t||"idle"!==k)return;const s={sender:"user",text:t,timestamp:Date.now()};w(e=>[...e,s]),v(""),N("thinking");try{await new Promise(e=>setTimeout(e,500));const e=await async function(e){const t=e.map(e=>({role:"ai"===e.sender?"model":"user",content:e.text}));let s=0;for(;s<3;)try{const e=new AbortController,a=setTimeout(()=>e.abort(),15e3),n=await fetch("https://ai-assistant-server-colf.onrender.com/api/gemini",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:t}),signal:e.signal});if(clearTimeout(a),!n.ok){if(429===n.status){s++,await d(1500*s);continue}throw new Error(`Gemini request failed (${n.status})`)}const r=await n.json();return r.data?.candidates?.[0]?.content?.parts?.[0]?.text||"âš ï¸ No response from Gemini."}catch(a){if(s>=2)return"âš ï¸ Gemini is currently unavailable. Please try again later.";s++,await d(1500*s)}return"âŒ Gemini API limit reached. Please try again later."}([...y,s]),t=function(e){if(!e)return"";let t=e.replace(/\r\n/g,"\n");return t=t.replace(/(\S)(```)/g,"$1\n$2"),t=t.replace(/(```)(\S)/g,"$1\n$2"),t=t.replace(/\n{3,}/g,"\n\n"),t.trim()}(e),a={sender:"ai",text:t,timestamp:Date.now()};w(e=>[...e,a]),b([...y,s,a])}catch(a){const e={sender:"ai",text:"âš ï¸ Something went wrong. Please try again.",timestamp:Date.now()};w(t=>[...t,e]),N("error")}finally{N("idle")}},[j,k,y,w,b]),M=e.useCallback(()=>{if(!y.length)return;const e=new Date,t=`AI_Chat_${e.toISOString().replace(/[:.]/g,"-")}.txt`,s=y.map(e=>`[${(e=>e?new Date(e).toLocaleString():"N/A")(e.timestamp)}] ${"user"===e.sender?"ðŸ§‘ User":"ðŸ¤– AI"}:\n${e.text}`).join("\n--------------------------------------\n\n"),a=["===== AI Chat Export =====",`Date: ${e.toLocaleDateString()}`,`Time: ${e.toLocaleTimeString()}`,`Total Messages: ${y.length}`,"======================================",""].join("\n"),n=new Blob([a+s],{type:"text/plain"}),r=URL.createObjectURL(n),i=document.createElement("a");i.href=r,i.download=t,i.click(),URL.revokeObjectURL(r)},[y]),A=e.useCallback(async()=>{if(!y.length)return;const e=`AI Chat on ${(new Date).toLocaleDateString()}`,t=`===== ${e} =====\n\n${y.map(e=>`${"user"===e.sender?"ðŸ§‘ User":"ðŸ¤– AI"}:\n${e.text}`).join("\n\n--------------------------------------\n\n")}`;if(navigator.share)try{await navigator.share({title:e,text:t})}catch(s){M()}else M()},[y,M]);return t.jsxs("div",{className:n("relative w-full h-full rounded-2xl overflow-hidden p-[2px]",a),children:[t.jsx(r.div,{className:"absolute inset-0 rounded-2xl border-2 border-white/20",animate:{rotate:[0,360]},transition:{duration:25,repeat:1/0,ease:"linear"}}),t.jsxs("div",{className:"relative flex flex-col w-full h-full rounded-xl border border-white/10 overflow-hidden bg-black/90 backdrop-blur-xl",children:[t.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-white/10 z-10 flex-wrap gap-2",children:[t.jsx("img",{src:s,alt:"Adarsh Logo",className:"w-8 h-8 rounded"}),t.jsx("h2",{className:"text-lg font-semibold text-white",children:"AD Assistant"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("button",{onClick:A,className:"icon-btn",title:"Share or Export Chat",children:t.jsx(c,{className:"w-4 h-4"})}),t.jsx("button",{onClick:M,className:"icon-btn",title:"Export Chat",children:t.jsx(o,{className:"w-4 h-4"})}),t.jsx("button",{onClick:g,className:"icon-btn",title:"Clear Chat",children:t.jsx(h,{className:"w-4 h-4"})}),i&&t.jsx("button",{onClick:i,className:"icon-btn",title:"Close Chat",children:t.jsx(l,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{ref:S,className:"flex-1 px-4 py-3 overflow-y-auto space-y-3 text-sm flex flex-col relative z-10",children:[y.map((s,a)=>t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"w-full h-10"}),children:t.jsx(p,{msg:s,onRegenerate:()=>C(s.text)})},a)),t.jsx(f,{status:k})]}),t.jsx(e.Suspense,{fallback:t.jsx("div",{className:"p-3 border-t border-white/10 h-[53px]"}),children:t.jsx(x,{value:j,onChange:v,onSend:()=>C(),disabled:"idle"!==k||!j.trim()})})]})]})}export{w as default};
